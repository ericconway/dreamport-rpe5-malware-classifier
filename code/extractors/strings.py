import collections
import re

__version__ = '0.1'
__enabled__ = True

MIN_STR_LEN = 6


def run(filepath='', fileinfo=None, **kwargs):
    print("%s.run(%s, %s, %s)"%(__name__, filepath, fileinfo, kwargs))
    with open(filepath, 'rb') as f:
        content = f.read()

    strings = collections.Counter()
    for st in re.finditer(b'[\x20-\x7e]{%d,}' % MIN_STR_LEN, content):
        st = st.group(0).decode('utf-8', errors='replace')

        # split long lines of minified text
        st = st.replace('><', '>;<')  # so we split minified html
        for s in st.split(';'):  # so we split minified javascript
            s = s.strip()  # so we aren't thrown by indentation
            if len(s) >= MIN_STR_LEN:
                strings[s] += 1

    return strings
