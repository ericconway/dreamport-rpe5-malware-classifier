/*------------------------------------------------------------------- name: single page pdc - modal js $author: skattima $ $datetime: 2013/09/18 09:32:01 $ $revision: #4 $ -------------------------------------------------------------------*/ /*-- code based on the wcms modal implementation --*/ handlemodal = function(config) { var currentwindowsize = { width: 0, height: 0 }; function handlewindowresize(event) { var dimension = event.data.dimension, newsize = $(window)[dimension](); if (!dimension) { return; } if (newsize == currentwindowsize[dimension]) { return; } currentwindowsize[dimension] = newsize; var handler = event.data.handler; if (!handler) { return; } event.data.handler(); } function getvaliddimension(dim, buffer) { var out = parseint(dim), finaldim = ''; if ($.browser.msie && parsefloat($.browser.version) >= 7.0 && parsefloat($.browser.version) <8.0) { // for some reason ie7 always does better calculating the height and width itself finaldim="auto" ; } else { if (isnan(out)) { finaldim="auto" ; } else { finaldim=(out + parseint(buffer)); } } return finaldim; } function createopenmodalhandler(config) { var modal=$("#"+config.target), marginwidth=40, marginheight=62; if (config.external== true ) { modal.html('<iframe style="border: 0;" frameborder="0" src="" + config.href + '" width="100%" height="99%"></iframe>').dialog({ modal: true, title: config.title || "", height: config.height, width: config.width, autoopen: false, resizable: false, draggable: false, closeonclick: true, open: function() { // adjust the width for ie8 with 'auto' config if ($.browser.msie && parsefloat($.browser.version) >= 8.0 && isnan(config.height)) { modal.dialog('option','width',(modal.innerwidth() - 20)); modalrelocate(); } // adjust the title bar for ie7 if ($.browser.msie && parsefloat($.browser.version) >= 7.0 && parsefloat($.browser.version) <8.0) { $('.ui-dialog-titlebar').css('width', (modal.parent().innerwidth() - marginwidth)); } // allow closing by clicking outside the modal window if (modal.dialog( "option", "closeonclick" )) { $(".ui-widget-overlay").bind('click', function() { modal.dialog('close'); }); } }, close: function() { // unbind scrolling and window resizing $(window).unbind("resize", handlewindowresize); // check for browser scroll events and relocate the modal. if ($.browser.msie && parsefloat($.browser.version) <=7.0) { // skip scroll events for ie6 & 7 } else { $(window).unbind("scroll", modalrelocate); } // reset titlebar dimensions for ie7 if ($.browser.msie && parsefloat($.browser.version)>= 7.0 && parsefloat($.browser.version) <8.0) { $('.ui-dialog-titlebar').css('width', ''); } // unbind closing by clicking outside the modal window if (modal.dialog( "option", "closeonclick" )) { $(".ui-widget-overlay").unbind('click'); } // empty() and destroy() are kind of broken until jquery 1.8.5 modal.remove(); } }); } else { modal.dialog({ modal: true, title: config.title || "", height: getvaliddimension(config.height, marginheight), width: getvaliddimension(config.width, marginwidth), autoopen: false, resizable: false, draggable: false, closeonclick: true, open: function() { // adjust the width for ie8 with 'auto' config if ($.browser.msie && parsefloat($.browser.version)>= 8.0 && isnan(config.height)) { modal.dialog('option','width',(modal.innerwidth() - 20)); modalrelocate(); } // adjust the title bar for ie7 if ($.browser.msie && parsefloat($.browser.version) >= 7.0 && parsefloat($.browser.version) <8.0) { $('.ui-dialog-titlebar').css('width', (modal.parent().innerwidth() - marginwidth)); } // allow closing by clicking outside the modal window if (modal.dialog( "option", "closeonclick" )) { $(".ui-widget-overlay").bind('click', function() { modal.dialog('close'); }); } }, close: function() { // reset titlebar dimensions for ie7 if ($.browser.msie && parsefloat($.browser.version)>= 7.0 && parsefloat($.browser.version) <8.0) { $('.ui-dialog-titlebar').css('width', ''); } // unbind closing by clicking outside the modal window if (modal.dialog( "option", "closeonclick" )) { $(".ui-widget-overlay").unbind('click'); } // empty() and destroy() are kind of broken until jquery 1.8.5 modal.remove(); } }); } function modalrelocate() { modal.dialog('option','position',['center','center']); } function modallaunch(combinedxobjects,combinedyobjects) { var modalx=null, modaly=null; if (combinedxobjects !=null) { modalx=( $(window).width() - combinedxobjects ) / 2; modal.dialog('option','width',combinedxobjects); } if (combinedyobjects !=null) { modaly=( $(window).height() - combinedyobjects ) / 2; modal.dialog('option','height',combinedyobjects); } if (modaly !=null && modalx !=null) { modal.dialog('option','position',[modalx,modaly]); } modal.dialog('open'); } function openmodal() { if ( config.external== false ) { modal.load(config.href, function(response, status) { var external=config.external; if (status== "error" && external== "undefined") { return true; } else { var browserie=$.browser.msie, browserversion=parsefloat($.browser.version); if (browserie && browserversion>= 7 && browserversion <8) { $("#"+config.target).css('width',config.width); } if (browserie && browserversion < 7){ if ($("#"+config.target + " img").length !=0) { var newimg=new image(), combinedxobjects=(newimg.width + marginwidth) - 20, combinedyobjects=newimg.height + marginheight + 11; newimg.src=modal.find("img").attr("src"); modal.dialog('option','width',combinedxobjects); modal.dialog('option','height',combinedyobjects); modal.dialog('open'); } else if ($("#"+config.target + " object").length !=0) { combinedxobjects=(parseint($("#"+config.target + " object").attr('width')) + marginwidth) - 20; combinedyobjects=parseint($("#"+config.target + " object").attr('height')) + marginheight + 8; modallaunch(combinedxobjects,combinedyobjects); } else { var modalwidth=config.width, modalheight="auto" ; modal.dialog('option','width',modalwidth); modal.dialog('option','height',modalheight); modal.dialog('open'); } } else { modal.dialog('open'); } } }); return false; } else { modal.dialog('open'); return false; } } openmodal(); } //top level on load actions everything before this are methods in the modal closure if (config=== undefined) { return; } currentwindowsize.width=$(window).width(); if (currentwindowsize.width>(parseint(config.width) || 0)) { // get modal element target from config var mid = config.target, e = $("#"+mid); // create a modal element if none found if (e[0] == null) { $('<div/>', {id: mid}).appendto('body'); } createopenmodalhandler(config); } };