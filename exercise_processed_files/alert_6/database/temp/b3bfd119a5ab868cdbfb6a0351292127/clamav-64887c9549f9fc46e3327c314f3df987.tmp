if (self.cavalrylogger) { cavalrylogger.start_js(["tyzea"]); } __d("banzaibase",["banzaiadapter","banzaiconsts","banzailazyqueue","errorutils","fblogger"],(function(a,b,c,d,e,f){__p&&__p();var g=b("banzaiadapter"),h="ods:banzai",i="send_via_beacon_failure",j=0,k=1,l=2,m=null,n,o=[],p=null,q=[];function r(a,b){a.__meta.status=j,a[3]=(a[3]||0)+1,!a.__meta.retry&&b>=400&&b<600&&o.push(a)}var s={adapter:g,send:b("banzaiconsts").send,ok:b("banzaiconsts").ok,error:b("banzaiconsts").error,shutdown:b("banzaiconsts").shutdown,vital_wait:b("banzaiconsts").vital_wait,basic_wait:b("banzaiconsts").basic_wait,vital:{delay:g.config.min_wait||b("banzaiconsts").vital_wait},basic:{delay:g.config.max_wait||b("banzaiconsts").basic_wait},isenabled:function(a){return g.config.gks&&g.config.gks[a]},post:function(a,c,d){__p&&__p();a||b("fblogger")("banzai").mustfix("banzai.post called without specifying a route");d=d||{};var e=d.retry;if(g.config.disabled)return;var f=g.config.blacklist;if(f&&(f.indexof&&(typeof f.indexof=="function"&&f.indexof(a)!=-1)))return;var h=s._wrapdata(a,c,s._geteventtime(),e);d.callback&&(h.__meta.callback=d.callback);d.compress!=null&&(h.__meta.compress=d.compress);f=d.delay;f==null&&(f=b("banzaiconsts").basic_wait);if(d.signal){h.__meta.status=k;c=[{user:s._getuserid(),page_id:s._getpageid(),posts:[h],trigger:a}];g.send(c,function(){h.__meta.status=l,h.__meta.callback&&h.__meta.callback()},function(a){r(h,a)},!0);if(!e)return}o.push(h);(s._schedule(f)||!p)&&(p=a);d=b("banzailazyqueue").flushqueue();d.foreach(function(a){return s.post.apply(s,a)})},registertosendwithbeacon:function(a,c,d,e){if(!(navigator&&navigator.sendbeacon&&g.isoktosendviabeacon()))return!1;if(!a){b("fblogger")("banzai").mustfix("banzai.registertosendwithbeacon called without specifying a route");return!1}q.push({cb:c,route:a,onsuccess:d,onfailure:e});return!0},flush:function(b,c){a.cleartimeout(m),m=null,s._sendwithcallbacks(b,c)},subscribe:g.subscribe,canusenavigatorbeacon:function(){return navigator&&navigator.sendbeacon&&g.isoktosendviabeacon()},_cansend:function(a){return a[2]>=s._geteventtime()-(g.config.expiry||b("banzaiconsts").expiry)},_getpostbuffer:function(){return o},_clearpostbuffer:function(){o=[]},_schedule:function(b){var c=s._geteventtime()+b;if(!n||c<n){n=c;m&&a.cleartimeout(m);m=a.settimeout(function(){s._sendwithcallbacks()},b);return!0}return!1},_sendwithcallbacks:function(a,c,d){__p&&__p();n=null;s._schedule(s.basic.delay);if(!g.readytosend()){c&&c();return}if(s.isenabled("flush_storage_periodically")||s.isenabled("error_impact_test")){var e=s._getstorage();b("errorutils").applywithguard(e.flush,e)}g.inform(b("banzaiconsts").send);e=[];var f=[];o=s._gatherwadsandpostsfrombuffer(e,f,!0,o,d);if(e.length<=0){g.inform(b("banzaiconsts").ok);a&&a();return}e[0].trigger=p;p=null;e[0].send_method="ajax";e.map(g.prepwadfortransit);g.send(e,function(){f.foreach(function(a){a.__meta.status=l,a.__meta.callback&&a.__meta.callback()}),a&&a()},function(a){f.foreach(function(b){r(b,a)}),c&&c()})},_gatherwadsandpostsfrombuffer:function(a,b,c,d,e){__p&&__p();e===void 0&&(e=null);var f={},g=d.length,h=!1;return d.filter(function(d,i){__p&&__p();if(h)return!0;var j=d.__meta;if(j.status>=l||!s._cansend(d))return!1;if(j.status>=k)return!0;var m=j.compress!=null?j.compress:!0,n=j.pageid+j.userid+(m?"compress":""),o=f[n];o||(o={user:j.userid,page_id:j.pageid,posts:[],snappy:m},f[n]=o,a.push(o));j.status=k;o.posts.push(d);b.push(d);e!=null&&e>0&&(e--,e==0&&(h=!0,i<g-1&&s._schedule(0)));return c&&j.retry})},_resetpoststatus:function(a){a.__meta.status=j},_store:function(a){a=s._getstorage();b("errorutils").applywithguard(a.store,a)},_restore:function(a){a=s._getstorage();b("errorutils").applywithguard(a.restore,a);s._schedule(g.config.restore_wait||b("banzaiconsts").vital_wait)},_wrapdata:function(a,b,c,d){a=[a,b,c,0];a.__meta={pageid:s._getpageid(),userid:s._getuserid(),retry:d===!0,status:j};return a},_trytosendviabeacon:function(){__p&&__p();if(!(navigator&&navigator.sendbeacon&&g.isoktosendviabeacon()))return!1;var b=[],c=[];o=s._gatherwadsandpostsfrombuffer(b,c,!1,o);if(b.length<=0)return!1;b[0].send_method="beacon";b.map(g.prepwadfortransit);b=new blob([g.addrequestauthdata(g.prepfortransit(b))],{type:"application/x-www-form-urlencoded"});b=a.navigator.sendbeacon(s.adapter.endpoint,b);if(!b){c.foreach(function(a){o.push(a)});o.push(s._wrapdata(h,(b={},b[i]=[1],b),s._geteventtime()));return!1}return!0},_processcallbacksandsendviabeacon:function(){__p&&__p();var b=[];q.foreach(function(a){var c=a.cb();c.foreach(function(c){var d=a.route;if(d){d=s._wrapdata(d,c,s._geteventtime());d.__meta.onsuccess=a.onsuccess;d.__meta.onfailure=a.onfailure;b.push(d)}})});q=[];var c=[],d=[];s._gatherwadsandpostsfrombuffer(c,d,!0,b);if(c.length>0){c[0].send_method="beacon";c.map(g.prepwadfortransit);c=new blob([g.addrequestauthdata(g.prepfortransit(c))],{type:"application/x-www-form-urlencoded"});c=a.navigator.sendbeacon(s.adapter.endpoint,c);c?d.foreach(function(a){return a.__meta&&a.__meta.onsuccess&&a.__meta.onsuccess()}):d.foreach(function(a){return a.__meta&&a.__meta.onfailure&&a.__meta.onfailure()})}},_unload:function(){navigator&&navigator.sendbeacon&&g.isoktosendviabeacon()&&s._processcallbacksandsendviabeacon(),g.cleanup(),g.inform(b("banzaiconsts").shutdown),o.length>0&&((!s.adapter.usebeacon||!s._trytosendviabeacon())&&s._store(!1))},_geteventtime:function(){return date.now()},_teststate:function(){return{postbuffer:o,triggerroute:p}},_getstorage:function(){return{store:function(){},restore:function(){},flush:function(){}}},_getpageid:function(){return"0"},_getuserid:function(){return"0"},_initialize:function(){}};e.exports=s}),null); __d("banzainew",["banzaibase","banzaiconsts","banzaistreampayloads","currentuser","executionenvironment","fbjson","navigationmetrics","setidletimeoutacrosstransitions","timeslice","visibility","webstorage","emptyfunction","isiniframe","lowerfacebookdomain","pageid","performanceabsolutenow","webstoragemutex"],(function(a,b,c,d,e,f){__p&&__p();var g="bz:",h={_getstorage:b("banzaibase")._getstorage,_getpageid:b("banzaibase")._getpageid,_getuserid:b("banzaibase")._getuserid,_initialize:b("banzaibase")._initialize,_schedule:b("banzaibase")._schedule,flush:b("banzaibase").flush,_unload:b("banzaibase")._unload,post:b("banzaibase").post},i=b("isiniframe")(),j=null,k,l,m,n,o=!1;function p(){o||(o=!0,n=b("webstorage").getlocalstorage());return n}function q(){var a="check_quota";try{var b=p();if(!b)return!1;b.setitem(a,a);b.removeitem(a);return!0}catch(a){return!1}}b("banzaibase")._getstorage=function(){__p&&__p();m||(!i?m={store:function(){var a=p();if(!a||b("banzaibase")._getpostbuffer().length<=0)return;var c=b("banzaibase")._getpostbuffer().map(function(a){return[a[0],a[1],a[2],a[3]||0,a.__meta]});b("banzaibase")._clearpostbuffer();b("webstorage").setitemguarded(a,g+b("pageid")+"."+b("banzaibase")._geteventtime(),b("fbjson").stringify(c))},restore:function(){__p&&__p();var a=p();if(!a)return;var c=b("webstoragemutex"),d=function(c){__p&&__p();var d=[];for(var e=0;e<a.length;e++){var f=a.key(e);f.indexof(g)===0&&f.indexof("bz:__")!==0&&d.push(f)}d.foreach(function(c){__p&&__p();var d=a.getitem(c);a.removeitem(c);if(!d)return;c=b("fbjson").parse(d);c.foreach(function(a){if(!a)return;var c=a.__meta=a.pop(),d=b("banzaibase")._cansend(a);if(!d)return;d=b("currentuser").getid();(c.userid===d||d==="0")&&(b("banzaibase")._resetpoststatus(a),b("banzaibase")._getpostbuffer().push(a))})});c&&c.unlock()};q()?new c("banzai").lock(d):b("setidletimeoutacrosstransitions").start(d,0)},flush:function(){var a=p();if(a){j===null&&(j=parseint(a.getitem(b("banzaiconsts").last_storage_flush),10));var c=j&&b("performanceabsolutenow")()-j>=b("banzaiconsts").storage_flush_interval;c&&b("banzaibase")._restore(!1);(c||!j)&&(j=b("performanceabsolutenow")(),b("webstorage").setitemguarded(a,b("banzaiconsts").last_storage_flush,j.tostring()))}}}:m={store:b("emptyfunction"),restore:b("emptyfunction"),flush:b("emptyfunction")});return m};b("banzaibase")._getpageid=function(){return b("pageid")};b("banzaibase")._getuserid=function(){return b("currentuser").getid()};b("banzaibase")._initialize=function(){b("executionenvironment").canusedom&&(b("banzaibase").adapter.usebeacon&&b("visibility").issupported()?(b("visibility").addlistener(b("visibility").hidden,function(){b("banzaibase")._getpostbuffer().length>0&&(b("banzaibase")._trytosendviabeacon()||b("banzaibase")._store(!1))}),(b("banzaibase").isenabled("enable_client_logging_clear_on_visible")||b("banzaibase").isenabled("error_impact_test"))&&b("visibility").addlistener(b("visibility").visible,function(){b("banzaibase")._trytosendviabeacon()||b("banzaibase")._restore(!1)})):b("banzaibase").adapter.sethooks(b("banzaibase")),b("banzaibase").adapter.setunloadhook(b("banzaibase")),b("navigationmetrics").addlistener(b("navigationmetrics").events.navigation_done,function(a,c){if(c.pagetype!=="normal")return;b("banzaibase")._restore(!1);b("navigationmetrics").removecurrentlistener()}))};b("banzaibase")._geteventtime=function(){return b("performanceabsolutenow")()};var r=b("timeslice").guard(function(){k=null,b("banzaibase")._sendwithcallbacks()},"banzai.send",{propagationtype:b("timeslice").propagationtype.orphan});b("banzaibase")._schedule=function(a){__p&&__p();var c=b("banzaibase")._geteventtime()+a;if(!k||c<k){k=c;b("setidletimeoutacrosstransitions").clear(l);c=function(){l=b("setidletimeoutacrosstransitions").start(r,a)};c();return!0}return!1};b("banzaibase").flush=function(a,c){b("setidletimeoutacrosstransitions").clear(l),k=null,b("banzaibase")._sendwithcallbacks(a,c)};b("banzaibase")._unload=function(){b("banzaistreampayloads").unload(b("banzaibase").post),h._unload()};b("banzaibase").post=function(c,d,e){__p&&__p();if(b("banzaibase").adapter.config.disabled)return;if(!b("executionenvironment").canusedom)return;if(i&&b("lowerfacebookdomain").isvaliddocumentdomain()){var f;try{f=a.top.require("banzai")}catch(a){f=null}if(f){f.post.apply(f,arguments);return}}h.post(c,d,e)};b("banzaibase")._initialize();e.exports=b("banzaibase")}),null); __d("falcobanzaipostfields",[],(function(a,b,c,d,e,f){e.exports=object.freeze({sampling_rate:"r",extra_data:"e"})}),null); __d("falcologgerinternal",["banzai","falcobanzaipostfields","falcojsloggersamplingpolicies"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g="falco:";function h(a){return a!==0&&math.random()*a<1}function i(a,c,d,e){if(h(c)){b("banzai").post(g+a,(a={},a[b("falcobanzaipostfields").extra_data]=d(),a[b("falcobanzaipostfields").sampling_rate]=c,a),e)}}e.exports={create:function(a){var c=b("falcojsloggersamplingpolicies").rates[a]||0;return{log:function(d){i(a,c,d,b("banzai").basic)},logimmediately:function(d){i(a,c,d,b("banzai").vital)}}}}}),null);